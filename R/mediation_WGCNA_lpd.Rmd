---
title: "mediation_DMR_DMP_final_pretty"
author: "Katharina Mattonet"
date: "9 M雷z 2021"
output: html_document
---

# load libraries

```{r libraries}
library(caret)
library(dplyr)
library(lme4)
library(lavaan)
library(semPlot)
library(semTools)
library(MASS)
library(Hmisc)
library(regsem)
library(IlluminaHumanMethylationEPICanno.ilm10b2.hg19)
```

# load data

```{r data}

#load("path/mediation_WGCNA_image4.RData")

load("path/mVal_github.RData")
load("path/pheno_data_N144_github.RData")

load("path/celltypes_estimates_github.RData")

load(file = "path/predictedPDS.RData")

load(file = "path/BMI_kids.RData")

eigenCpGs <- readRDS(file = "path/wagcna_eigencpgs_fsub.rds")


hubCpG <- readRDS(file = "path/tophub_fsub2.rds")

load("pathe/top_modules_f_pcdf130_round_CI.RData")
```

# subset data sex-combined

```{r subset data}

# add BMI to other pheno data
pheno_data <- left_join(pheno_data, BMI, by = "B_StdNr")
BMI_red <- subset(pheno_data, select = c(D_StdNr, bmi_u6, bmi_u7, bmi_u8, bmi_u9, bmi_u10, bmi_u11, diffu11u6))
colnames(BMI_red)[8] <- "BMI_kids_diffu15u6" 


# sex combined

## create data set to analyse
pheno_data <- pheno_data[ !(pheno_data$D_StdNr %in% c(157, 55)), ]
ct_estimate <- ct_estimate[ !(ct_estimate$D_StdNr %in% c(157, 55)), ]
pheno_data <- left_join(pheno_data, ct_estimate)

slopePDS <- data.frame(as.integer(all_data_wide$D_StdNr), all_data_wide$slopePDS, all_data_wide$PDS_diffU15U6)
colnames(slopePDS) <- c("D_StdNr", "slopePDS", "slopeDiffU15U6")
pheno_data <- left_join(pheno_data, slopePDS, by = "D_StdNr")
pheno_data <- left_join(pheno_data, BMI_red, by = "D_StdNr")

mVal <- mVals_noNA_df
mVal$`55` <- NULL
mVal$`157` <- NULL

pheno_data$AMP_Plate <- factor(pheno_data$AMP_Plate, levels = c("WG6975702-MSA4", "WG6975703-MSA4"), labels = c(0,1))
pheno_data$sex_n <- as.numeric(levels(pheno_data$sex_n))[pheno_data$sex_n]
pheno_data$PCDF130c <- scale(pheno_data$PCDF130, center = TRUE, scale = FALSE)


hubCpG <- data.frame(hubCpG)
hubCpG$module <- rownames(hubCpG)
rownames(hubCpG) <- c(1:173)

```

# eigenCpG in WGCNA-modules only females

```{r eigenCpG in modules}

eigenCpGs_df <- data.frame(eigenCpGs[["eigengenes"]])
eigenCpGs_sigmodule_f <- eigenCpGs_df[,((colnames(eigenCpGs_df)) %in% top_modules_f_pcdf130_round$modules)]

sigGO_modules_f <- c("MEbrown", "MElightcyan1", "MEred", "MEsalmon", "MEwhite", "MEyellow")
eigenCpGs_sigGO_f <- eigenCpGs_df[,((colnames(eigenCpGs_df)) %in% sigGO_modules_f)]
eigenCpGs_sigGO_f$D_StdNr <- as.integer(rownames(eigenCpGs_sigGO_f))

pheno_data_f <- pheno_data[pheno_data$sex_n == 0,]

pheno_data_f <- left_join(pheno_data_f, eigenCpGs_sigGO_f, by = "D_StdNr")

```

# hubGpG of WGCNA-modules

```{r hubCpG}

#top_modules_f_pcdf130_round$module <- gsub(".*ME","", top_modules_f_pcdf130_round$modules)
#hubCpG_sigmodule <- hubCpG[(hubCpG$module %in% top_modules_f_pcdf130_round$module), ]
#hubCpG_sigmodule$hubCpG <- as.character(droplevels(hubCpG_sigmodule$hubCpG))

sigGO_modules_fm <- gsub(".*ME","", sigGO_modules_f)

hubCpG_sigGO <- hubCpG[(hubCpG$module %in% sigGO_modules_fm), ]

#hubCpG_M <- mVal[hubCpG_sigGO$hubCpG,]
#hubCpG_M_wrong <- hubCpG_M
hubCpG_M <- mVal[rownames(mVal) %in% hubCpG_sigGO$hubCpG,]

hubCpG_M_t <- data.frame(t(hubCpG_M))
pheno_data <- cbind(pheno_data, hubCpG_M_t)

```

# set seed for replication

```{r seed}

set.seed(123)

```

# check data for normal distribution eigenCpG - females only

```{r check out eigenCpG}
var(pheno_data_f$slopePDS, na.rm = TRUE) #   0.00019216, use slopeDiffU15U6 as outcome in main models
length(which(is.na(pheno_data_f$slopeDiffU15U6))) # yes 35
length(which(is.na(pheno_data_f$slopePDS))) # yes 35

skew(pheno_data_f$slopePDS)
kurtosis(pheno_data_f$slopePDS)
skew(pheno_data_f$slopeDiffU15U6)
kurtosis(pheno_data_f$slopeDiffU15U6)
skew(pheno_data_f$PCDF130c)
kurtosis(pheno_data_f$PCDF130c)

# covariate preselection
corrmatrixY_pcdf130_f <- as.matrix(subset(pheno_data_f, select = c(slopeDiffU15U6, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, BMI_kids_diffu15u6)))
rcorr(corrmatrixY_pcdf130_f)$P[, "slopeDiffU15U6"] # p < .05 including in following mediation model

# Y = slopePDS
corrmatrixYslope_pcdf130_f <- as.matrix(subset(pheno_data_f, select = c(slopePDS, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, BMI_kids_diffu15u6)))
rcorr(corrmatrixYslope_pcdf130_f)$P[, 1] # p < .05 (rounded) including in following mediation model

## crate APA-table of correlation matrix
### function
corstarsl <- function(x){
require(Hmisc)
x <- as.matrix(x)
R <- rcorr(x)$r
p <- rcorr(x)$P
p <- round(p, digits = 2)

## define notions for significance levels; spacing is important.
mystars <- ifelse(p < .01, "**", ifelse(p < .05, "*", " "))

## trunctuate the matrix that holds the correlations to two decimal
R <- format(round(cbind(rep(-1.11, ncol(x)), R), 2))[,-1]

## build a new matrix that includes the correlations with their apropriate stars
Rnew <- matrix(paste(R, mystars, sep=""), ncol=ncol(x))
diag(Rnew) <- paste(diag(R), " ", sep="")
rownames(Rnew) <- colnames(x)
colnames(Rnew) <- paste(colnames(x), "", sep="")

## remove upper triangle
Rnew <- as.matrix(Rnew)
Rnew[upper.tri(Rnew, diag = TRUE)] <- ""
Rnew <- as.data.frame(Rnew)

## remove last column and return the matrix (which is now a data frame)
Rnew <- cbind(Rnew[1:length(Rnew)-1])
return(Rnew)
} 

corrtable <- as.data.frame(corstarsl(corrmatrixY_pcdf130_f)[2:8,1])
colnames(corrtable) <- "PDS score (t5-t0)\n (N=73)"
rownames(corrtable) <- c("mother압 age at birth", "gestational length", "mother압 smoking status during pregnancy", "neonate압 birth weight", "mother압 education level", "mother압 BMI before pregnancy", "child압 BMI\n(t5-t0)")

#write.csv2(corrtable, file = "path/mediation_WGCNA_corrtable_covvardiffPDSu6U15_f_N73.csv")

corrtable_slope <- as.data.frame(corstarsl(corrmatrixYslope_pcdf130_f)[2:8,1])
colnames(corrtable_slope) <- "slope PDS\n (N=73)"
rownames(corrtable_slope) <- c("mother압 age at birth", "gestational length", "mother압 smoking status during pregnancy", "neonate압 birth weight", "mother압 education level", "mother압 BMI before pregnancy", "child압 BMI\n(t5-t0)")

#write.csv2(corrtable_slope, file = "path/mediation_WGCNA_corrtable_covvarslopePDS_f_N73.csv")

```

# PCDF130 eigenCpG of sig module brown in females only
 
```{r medmodel pcdf130 female eigenCpG brown}

corrmatrixM_pcdf130_brown_f <- as.matrix(subset(pheno_data_f, select = c(MEbrown, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, CD4T, CD8T, Mono, NK, Gran, Bcell, AMP_Plate)))
rcorr(corrmatrixM_pcdf130_brown_f)$P[, "MEbrown"] # p < .05 including in following mediation model

corrtable_pcdf130_brown_f <- as.data.frame(corstarsl(corrmatrixM_pcdf130_brown_f)[2:14,1])
colnames(corrtable_pcdf130_brown_f) <- "eigenCpG (brown module)"
rownames(corrtable_pcdf130_brown_f) <- c("mother압 age at birth", "gestational length", "mother압 smoking status during pregnancy", "neonate압 birth weight", "mother압 education level", "mother압 BMI before pregnancy", "CD4T fraction", "CD8T fraction", "monocyte fraction", "NK fraction", "granulocyte fraction", "Bcell fraction", "EPIC assay plate")

skew(pheno_data_f$MEbrown)
kurtosis(pheno_data_f$MEbrown)

model_pcdf130_brown_feeee <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MEbrown + CD4T + NK + Bcell + AMP_Plate
          MEbrown ~ a*PCDF130 + CD4T + NK + Bcell + AMP_Plate
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_brown_f.fit.YBeeee <- sem(model_pcdf130_brown_feeee, data = pheno_data_f, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_brown_f.fit.YBeeee, fit = TRUE, rsquar = TRUE)

model_pcdf130_brown_feee <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MEbrown + NK + Bcell + AMP_Plate
          MEbrown ~ a*PCDF130 + NK + Bcell + AMP_Plate
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_brown_f.fit.YBeee <- sem(model_pcdf130_brown_feee, data = pheno_data_f, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_brown_f.fit.YBeee, fit = TRUE, rsquar = TRUE)

model_pcdf130_brown_fee <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MEbrown + Bcell + AMP_Plate
          MEbrown ~ a*PCDF130 + Bcell + AMP_Plate
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_brown_f.fit.YBee <- sem(model_pcdf130_brown_fee, data = pheno_data_f, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_brown_f.fit.YBee, fit = TRUE, rsquar = TRUE)


# final model
model_pcdf130_brown_f <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MEbrown + Bcell + AMP_Plate
          MEbrown ~ a*PCDF130 + Bcell + AMP_Plate
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_brown_f.fit.YB <- sem(model_pcdf130_brown_f, data = pheno_data_f, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_brown_f.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdf130_brown_f.fit.YB, ci = T, boot.ci.type = "bca.simple")

model_pcdf130_slope_brown_f <- '
          slopePDS ~ c*PCDF130 + b*MEbrown + Bcell + AMP_Plate
          MEbrown ~ a*PCDF130 + Bcell + AMP_Plate
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_slope_brown_f.fit.YB <- sem(model_pcdf130_slope_brown_f, data = pheno_data_f, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x") 
summary(model_pcdf130_slope_brown_f.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!

```

# PCDF130 eigenCpG of sig module lightcyan1 in females only
 
```{r medmodel pcdf130 female eigenCpG lightcyan1}

corrmatrixM_pcdf130_lightcyan1_f <- as.matrix(subset(pheno_data_f, select = c(MElightcyan1, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, CD4T, CD8T, Mono, NK, Gran, Bcell, AMP_Plate)))
rcorr(corrmatrixM_pcdf130_lightcyan1_f)$P[, "MElightcyan1"] # p < .05 including in following mediation model

corrtable_pcdf130_lightcyan1_f <- as.data.frame(corstarsl(corrmatrixM_pcdf130_lightcyan1_f)[2:14,1])
colnames(corrtable_pcdf130_lightcyan1_f) <- "eigenCpG (lightcyan1 module)"
rownames(corrtable_pcdf130_lightcyan1_f) <- c("mother압 age at birth", "gestational length", "mother압 smoking status during pregnancy", "neonate압 birth weight", "mother압 education level", "mother압 BMI before pregnancy", "CD4T fraction", "CD8T fraction", "monocyte fraction", "NK fraction", "granulocyte fraction", "Bcell fraction", "EPIC assay plate")
corrtable_covvareigenCpG <- cbind(corrtable_pcdf130_brown_f, corrtable_pcdf130_lightcyan1_f)

skew(pheno_data_f$MElightcyan1)
kurtosis(pheno_data_f$MElightcyan1)

model_pcdf130_lightcyan1_feeeee <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MElightcyan1 + dur_gest + CD4T + NK + Gran + Bcell
          MElightcyan1 ~ a*PCDF130 + dur_gest + CD4T + NK + Gran + Bcell
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_lightcyan1_f.fit.YBeeeee <- sem(model_pcdf130_lightcyan1_feeeee, data = pheno_data_f, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_lightcyan1_f.fit.YBeeeee, fit = TRUE, rsquar = TRUE)

model_pcdf130_lightcyan1_feeee <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MElightcyan1 + CD4T + NK + Gran + Bcell
          MElightcyan1 ~ a*PCDF130 + CD4T + NK + Gran + Bcell
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_lightcyan1_f.fit.YBeeee <- sem(model_pcdf130_lightcyan1_feeee, data = pheno_data_f, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_lightcyan1_f.fit.YBeeee, fit = TRUE, rsquar = TRUE)

# final model
model_pcdf130_lightcyan1_f <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MElightcyan1 + CD4T + NK + Gran + Bcell
          MElightcyan1 ~ a*PCDF130 + CD4T + NK + Gran + Bcell
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_lightcyan1_f.fit.YB <- sem(model_pcdf130_lightcyan1_f, data = pheno_data_f, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_lightcyan1_f.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdf130_lightcyan1_f.fit.YB, ci = T, boot.ci.type = "bca.simple")

model_pcdf130_slope_lightcyan1_f <- '
          slopePDS ~ c*PCDF130 + b*MElightcyan1 + CD4T + NK + Gran + Bcell
          MElightcyan1 ~ a*PCDF130 + CD4T + NK + Gran + Bcell
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_slope_lightcyan1_f.fit.YB <- sem(model_pcdf130_slope_lightcyan1_f, data = pheno_data_f, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_slope_lightcyan1_f.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!
parameterEstimates(model_pcdf130_slope_lightcyan1_f.fit.YB, ci = T, boot.ci.type = "bca.simple")

```

# PCDF130 eigenCpG of sig module red in females only

```{r medmodel pcdf130 female eigenCpG red}

corrmatrixM_pcdf130_red_f <- as.matrix(subset(pheno_data_f, select = c(MEred, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, CD4T, CD8T, Mono, NK, Gran, Bcell, AMP_Plate)))
rcorr(corrmatrixM_pcdf130_red_f)$P[, "MEred"] # p < .05 including in following mediation model

corrtable_pcdf130_red_f <- as.data.frame(corstarsl(corrmatrixM_pcdf130_red_f)[2:14,1])
colnames(corrtable_pcdf130_red_f) <- "eigenCpG (red module)"
rownames(corrtable_pcdf130_red_f) <- c("mother압 age at birth", "gestational length", "mother압 smoking status during pregnancy", "neonate압 birth weight", "mother압 education level", "mother압 BMI before pregnancy", "CD4T fraction", "CD8T fraction", "monocyte fraction", "NK fraction", "granulocyte fraction", "Bcell fraction", "EPIC assay plate")
corrtable_covvareigenCpG <- cbind(corrtable_covvareigenCpG, corrtable_pcdf130_red_f)

skew(pheno_data_f$MEred)
kurtosis(pheno_data_f$MEred)

# model selection
model_pcdf130_red_fe <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MEred + AMP_Plate
          MEred ~ a*PCDF130 + AMP_Plate
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_red_f.fit.YBe <- sem(model_pcdf130_red_fe, data = pheno_data_f, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_red_f.fit.YBe, fit = TRUE, rsquar = TRUE)


# final model
model_pcdf130_red_f <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MEred + AMP_Plate
          MEred ~ a*PCDF130 + AMP_Plate
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_red_f.fit.YB <- sem(model_pcdf130_red_f, data = pheno_data_f, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_red_f.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdf130_red_f.fit.YB, ci = T, boot.ci.type = "bca.simple")

model_pcdf130_slope_red_f <- '
          slopePDS ~ c*PCDF130 + b*MEred + AMP_Plate
          MEred ~ a*PCDF130 + AMP_Plate
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_slope_red_f.fit.YB <- sem(model_pcdf130_slope_red_f, data = pheno_data_f, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_slope_red_f.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!
parameterEstimates(model_pcdf130_slope_red_f.fit.YB, ci = T, boot.ci.type = "bca.simple")

```

# PCDF130 eigenCpG of sig module salmon in females only

```{r medmodel pcdf130 female eigenCpG salmon}

corrmatrixM_pcdf130_salmon_f <- as.matrix(subset(pheno_data_f, select = c(MEsalmon, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, CD4T, CD8T, Mono, NK, Gran, Bcell, AMP_Plate)))
rcorr(corrmatrixM_pcdf130_salmon_f)$P[, "MEsalmon"] # p < .05 including in following mediation model

corrtable_pcdf130_salmon_f <- as.data.frame(corstarsl(corrmatrixM_pcdf130_salmon_f)[2:14,1])
colnames(corrtable_pcdf130_salmon_f) <- "eigenCpG (salmon module)"
rownames(corrtable_pcdf130_salmon_f) <- c("mother압 age at birth", "gestational length", "mother압 smoking status during pregnancy", "neonate압 birth weight", "mother압 education level", "mother압 BMI before pregnancy", "CD4T fraction", "CD8T fraction", "monocyte fraction", "NK fraction", "granulocyte fraction", "Bcell fraction", "EPIC assay plate")
corrtable_covvareigenCpG <- cbind(corrtable_covvareigenCpG, corrtable_pcdf130_salmon_f)

skew(pheno_data_f$MEsalmon)
kurtosis(pheno_data_f$MEsalmon)

# model selection
model_pcdf130_salmon_fee <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MEsalmon + Bcell + AMP_Plate
          MEsalmon ~ a*PCDF130 + Bcell + AMP_Plate
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_salmon_f.fit.YBee <- sem(model_pcdf130_salmon_fee, data = pheno_data_f, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_salmon_f.fit.YBee, fit = TRUE, rsquar = TRUE)

# final model
model_pcdf130_salmon_f <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MEsalmon + Bcell + AMP_Plate
          MEsalmon ~ a*PCDF130 + Bcell + AMP_Plate
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_salmon_f.fit.YB <- sem(model_pcdf130_salmon_f, data = pheno_data_f, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_salmon_f.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdf130_salmon_f.fit.YB, ci = T, boot.ci.type = "bca.simple")

model_pcdf130_slope_salmon_f <- '
          slopePDS ~ c*PCDF130 + b*MEsalmon + Bcell + AMP_Plate
          MEsalmon ~ a*PCDF130 + Bcell + AMP_Plate
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_slope_salmon_f.fit.YB <- sem(model_pcdf130_slope_salmon_f, data = pheno_data_f, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x") 
summary(model_pcdf130_slope_salmon_f.fit.YB, fit = TRUE, rsquar = TRUE) # DOES converte!
parameterEstimates(model_pcdf130_slope_salmon_f.fit.YB, ci = T, boot.ci.type = "bca.simple")

```

# PCDF130 eigenCpG of sig module white in females only

```{r medmodel pcdf130 female eigenCpG white}

corrmatrixM_pcdf130_white_f <- as.matrix(subset(pheno_data_f, select = c(MEwhite, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, CD4T, CD8T, Mono, NK, Gran, Bcell, AMP_Plate)))
rcorr(corrmatrixM_pcdf130_white_f)$P[, "MEwhite"] # p < .05 including in following mediation model

corrtable_pcdf130_white_f <- as.data.frame(corstarsl(corrmatrixM_pcdf130_white_f)[2:14,1])
colnames(corrtable_pcdf130_white_f) <- "eigenCpG (white module)"
rownames(corrtable_pcdf130_white_f) <- c("mother압 age at birth", "gestational length", "mother압 smoking status during pregnancy", "neonate압 birth weight", "mother압 education level", "mother압 BMI before pregnancy", "CD4T fraction", "CD8T fraction", "monocyte fraction", "NK fraction", "granulocyte fraction", "Bcell fraction", "EPIC assay plate")
corrtable_covvareigenCpG <- cbind(corrtable_covvareigenCpG, corrtable_pcdf130_white_f)

skew(pheno_data_f$MEwhite)
kurtosis(pheno_data_f$MEwhite)

# model selection
model_pcdf130_white_feeee <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MEwhite + dur_gest + CD4T + Gran + Bcell
          MEwhite ~ a*PCDF130 + dur_gest + CD4T + Gran + Bcell
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_white_f.fit.YBeeee <- sem(model_pcdf130_white_feeee, data = pheno_data_f, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_white_f.fit.YBeeee, fit = TRUE, rsquar = TRUE)

model_pcdf130_white_feee <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MEwhite + CD4T + Gran + Bcell
          MEwhite ~ a*PCDF130 + CD4T + Gran + Bcell
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_white_f.fit.YBeee <- sem(model_pcdf130_white_feee, data = pheno_data_f, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_white_f.fit.YBeee, fit = TRUE, rsquar = TRUE)

model_pcdf130_white_fee <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MEwhite + CD4T + Bcell
          MEwhite ~ a*PCDF130 + CD4T + Bcell
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_white_f.fit.YBee <- sem(model_pcdf130_white_fee, data = pheno_data_f, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_white_f.fit.YBee, fit = TRUE, rsquar = TRUE)

# final model
model_pcdf130_white_f <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MEwhite + CD4T + Bcell
          MEwhite ~ a*PCDF130 + CD4T + Bcell
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_white_f.fit.YB <- sem(model_pcdf130_white_f, data = pheno_data_f, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_white_f.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdf130_white_f.fit.YB, ci = T, boot.ci.type = "bca.simple")

model_pcdf130_slope_white_f <- '
          slopePDS ~ c*PCDF130 + b*MEwhite + CD4T + Bcell
          MEwhite ~ a*PCDF130 + CD4T + Bcell
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_slope_white_f.fit.YB <- sem(model_pcdf130_slope_white_f, data = pheno_data_f, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_slope_white_f.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!
parameterEstimates(model_pcdf130_slope_white_f.fit.YB, ci = T, boot.ci.type = "bca.simple")

```

# PCDF130 eigenCpG of sig module yellow in females only

```{r medmodel pcdf130 female eigenCpG yellow}

corrmatrixM_pcdf130_yellow_f <- as.matrix(subset(pheno_data_f, select = c(MEyellow, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, CD4T, CD8T, Mono, NK, Gran, Bcell, AMP_Plate)))
rcorr(corrmatrixM_pcdf130_yellow_f)$P[, "MEyellow"] # p < .05 including in following mediation model

corrtable_pcdf130_yellow_f <- as.data.frame(corstarsl(corrmatrixM_pcdf130_yellow_f)[2:14,1])
colnames(corrtable_pcdf130_yellow_f) <- "eigenCpG (yellow module)"
rownames(corrtable_pcdf130_yellow_f) <- c("mother압 age at birth", "gestational length", "mother압 smoking status during pregnancy", "neonate압 birth weight", "mother압 education level", "mother압 BMI before pregnancy", "CD4T fraction", "CD8T fraction", "monocyte fraction", "NK fraction", "granulocyte fraction", "Bcell fraction", "EPIC assay plate")
corrtable_covvareigenCpG <- cbind(corrtable_covvareigenCpG, corrtable_pcdf130_yellow_f)

#write.csv2(corrtable_covvareigenCpG, file = "path/mediation_WGCNA_corrtable_covvareigenCpG_f_N73.csv")

skew(pheno_data_f$MEyellow)
kurtosis(pheno_data_f$MEyellow)

# model selection
model_pcdf130_yellow_fee <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MEyellow + CD4T + Bcell 
          MEyellow ~ a*PCDF130 + CD4T + Bcell
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_yellow_f.fit.YBee <- sem(model_pcdf130_yellow_fee, data = pheno_data_f, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_yellow_f.fit.YBee, fit = TRUE, rsquar = TRUE)

model_pcdf130_yellow_fe <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MEyellow + Bcell 
          MEyellow ~ a*PCDF130 + Bcell
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_yellow_f.fit.YBe <- sem(model_pcdf130_yellow_fe, data = pheno_data_f, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_yellow_f.fit.YBe, fit = TRUE, rsquar = TRUE)

# final model

model_pcdf130_yellow_f <- '
          slopeDiffU15U6 ~ c*PCDF130 + b*MEyellow + Bcell 
          MEyellow ~ a*PCDF130 + Bcell
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_yellow_f.fit.YB <- sem(model_pcdf130_yellow_f, data = pheno_data_f, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_yellow_f.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdf130_yellow_f.fit.YB, ci = T, boot.ci.type = "bca.simple")

model_pcdf130_slope_yellow_f <- '
          slopePDS ~ c*PCDF130 + b*MEyellow + Bcell
          MEyellow ~ a*PCDF130 + Bcell
		      indirect := a*b
		      total := c + indirect' 
model_pcdf130_slope_yellow_f.fit.YB <- sem(model_pcdf130_slope_yellow_f, data = pheno_data_f, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_slope_yellow_f.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!
parameterEstimates(model_pcdf130_slope_yellow_f.fit.YB, ci = T, boot.ci.type = "bca.simple")

```

# check data for normal distribution hubCpG - both sexes 

```{r check out hubCpG}
var(pheno_data$slopePDS, na.rm = TRUE) #  0.002280033, use slopeDiffU15U6 as outcome in main models
length(which(is.na(pheno_data$slopeDiffU15U6))) # yes 66
length(which(is.na(pheno_data$slopePDS))) # yes 66

skew(pheno_data$slopePDS)
kurtosis(pheno_data$slopePDS)
skew(pheno_data$slopeDiffU15U6)
kurtosis(pheno_data$slopeDiffU15U6)
skew(pheno_data$PCDF130c)
kurtosis(pheno_data$PCDF130c)
# not normal distributed data -> use robust test of satorra.bentler (Finney& DiStefano, 2006: in Eid Statistik S. 881 (pdf p914))
# not normal distributed data -> use robust test of satorra.bentler (Finney & DiStefano, 2006: in Eid Statistik S. 881 (pdf p914)) -> to included missing data use yuan.bentler (https://groups.google.com/g/lavaan/c/AvBtkDWp3nI, https://groups.google.com/g/lavaan/c/0E9EdihR-dc) yuan.bentler is version of satorra.bentler for incomplete cases (sb only for complete cases) -> why to included missing data: https://psu-psychology.github.io/psy-597-sem-sp2019/10_best_practices/important_odds_and_ends.html


# covariate preselection
corrmatrixY_pcdf130 <- as.matrix(subset(pheno_data, select = c(slopeDiffU15U6, sex_n, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, BMI_kids_diffu15u6)))
rcorr(corrmatrixY_pcdf130)$P[, "slopeDiffU15U6"] # p < .05 including in following mediation model

# Y = slopePDS
corrmatrixYslope_pcdf130 <- as.matrix(subset(pheno_data, select = c(slopePDS, sex_n, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, BMI_kids_diffu15u6)))
rcorr(corrmatrixYslope_pcdf130)$P[, 1] # p < .05 (rounded) including in following mediation model

corrtable_all <- as.data.frame(corstarsl(corrmatrixY_pcdf130)[2:9,1])
colnames(corrtable_all) <- "PDS score (t5-t0)\n (N=142)"
rownames(corrtable_all) <- c("neonate압 sex", "mother압 age at birth", "gestational length", "mother압 smoking status during pregnancy", "neonate압 birth weight", "mother압 education level", "mother압 BMI before pregnancy", "child압 BMI\n(t5-t0)")

#write.csv2(corrtable_all, file = "path/mediation_WGCNA_corrtable_covvardiffPDSu6U15_all_N142.csv")


corrtable_all_slope <- as.data.frame(corstarsl(corrmatrixYslope_pcdf130)[2:9,1])
colnames(corrtable_all_slope) <- "slope PDS\n (N=142)"
rownames(corrtable_all_slope) <- c("neonate압 sex", "mother압 age at birth", "gestational length", "mother압 smoking status during pregnancy", "neonate압 birth weight", "mother압 education level", "mother압 BMI before pregnancy", "child압 BMI\n(t5-t0)")

#write.csv2(corrtable_all_slope, file = "path/mediation_WGCNA_corrtable_covvarslopePDS_all_N142.csv")
```

# PCDF130 hubCpG of sig modules brown

```{r medmodel hubCpG brown}

corrmatrixM_pcdf130_cg09899564 <- as.matrix(subset(pheno_data, select = c(cg09899564, sex_n, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, CD4T, CD8T, Mono, NK, Gran, Bcell, AMP_Plate)))
rcorr(corrmatrixM_pcdf130_cg09899564)$P[, "cg09899564"] # p < .05 including in following mediation model

corrtable_pcdf130_brown_hubCpG <- as.data.frame(corstarsl(corrmatrixM_pcdf130_cg09899564)[2:15,1])
colnames(corrtable_pcdf130_brown_hubCpG) <- "hubCpG (brown module)"
rownames(corrtable_pcdf130_brown_hubCpG) <- c("neonate압 sex", "mother압 age at birth", "gestational length", "mother압 smoking status during pregnancy", "neonate압 birth weight", "mother압 education level", "mother압 BMI before pregnancy", "CD4T fraction", "CD8T fraction", "monocyte fraction", "NK fraction", "granulocyte fraction", "Bcell fraction", "EPIC assay plate")

skew(pheno_data$cg09899564)
kurtosis(pheno_data$cg09899564)

# model selection 
model_pcdf130_cg09899564e <- '
          slopeDiffU15U6 ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg09899564 + Bcell
          cg09899564 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + Bcell
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1
          ' 
model_pcdf130_cg09899564.fit.YBe <- sem(model_pcdf130_cg09899564e, data = pheno_data, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_cg09899564.fit.YBe, fit = TRUE, rsquar = TRUE)

# final model 
model_pcdf130_cg09899564 <- '
          slopeDiffU15U6 ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg09899564 + Bcell
          cg09899564 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + Bcell
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1
          ' 
model_pcdf130_cg09899564.fit.YB <- sem(model_pcdf130_cg09899564, data = pheno_data, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_cg09899564.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdf130_cg09899564.fit.YB, ci = T, boot.ci.type = "bca.simple")

model_pcdf130_slope_cg09899564 <- '
          slopePDS ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg09899564 + Bcell
          cg09899564 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + Bcell
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_slope_cg09899564.fit.YB <- sem(model_pcdf130_slope_cg09899564, data = pheno_data, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x") 
summary(model_pcdf130_slope_cg09899564.fit.YB, fit = TRUE, rsquar = TRUE) # doesn앖 converte!
parameterEstimates(model_pcdf130_slope_cg09899564.fit.YB, ci = T, boot.ci.type = "bca.simple")

```

# PCDF130 hubCpG of sig modules lightcyan1

```{r medmodel hubCpG lightcyan1}

# covariate preselection

corrmatrixM_pcdf130_cg11468953 <- as.matrix(subset(pheno_data, select = c(cg11468953, sex_n, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, CD4T, CD8T, Mono, NK, Gran, Bcell, AMP_Plate)))
rcorr(corrmatrixM_pcdf130_cg11468953)$P[, "cg11468953"] # p < .05 including in following mediation model

corrtable_pcdf130_lightcyan1_hubCpG <- as.data.frame(corstarsl(corrmatrixM_pcdf130_cg11468953)[2:15,1])
colnames(corrtable_pcdf130_lightcyan1_hubCpG) <- "hubCpG (lightcyan1 module)"
rownames(corrtable_pcdf130_lightcyan1_hubCpG) <- c("neonate압 sex", "mother압 age at birth", "gestational length", "mother압 smoking status during pregnancy", "neonate압 birth weight", "mother압 education level", "mother압 BMI before pregnancy", "CD4T fraction", "CD8T fraction", "monocyte fraction", "NK fraction", "granulocyte fraction", "Bcell fraction", "EPIC assay plate")
corrtable_covvarhubCpG <- cbind(corrtable_pcdf130_brown_hubCpG, corrtable_pcdf130_lightcyan1_hubCpG)


skew(pheno_data$cg11468953)
kurtosis(pheno_data$cg11468953)

# model selection
model_pcdf130_cg11468953eee <- '
          slopeDiffU15U6 ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg11468953 + CD4T + Gran + Bcell
          cg11468953 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + CD4T + Gran + Bcell
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_cg11468953.fit.YBeee <- sem(model_pcdf130_cg11468953eee, data = pheno_data, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_cg11468953.fit.YBeee, fit = TRUE, rsquar = TRUE)

model_pcdf130_cg11468953ee <- '
          slopeDiffU15U6 ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg11468953 + CD4T + Bcell
          cg11468953 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + CD4T + Bcell
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_cg11468953.fit.YBee <- sem(model_pcdf130_cg11468953ee, data = pheno_data, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_cg11468953.fit.YBee, fit = TRUE, rsquar = TRUE)

# final model
model_pcdf130_cg11468953 <- '
          slopeDiffU15U6 ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg11468953 + CD4T + Bcell
          cg11468953 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + CD4T + Bcell
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_cg11468953.fit.YB <- sem(model_pcdf130_cg11468953, data = pheno_data, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_cg11468953.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdf130_cg11468953.fit.YB, ci = T, boot.ci.type = "bca.simple")


model_pcdf130_slope_cg11468953 <- '
          slopePDS ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg11468953 + CD4T + Bcell
          cg11468953 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + CD4T + Bcell
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_slope_cg11468953.fit.YB <- sem(model_pcdf130_slope_cg11468953, data = pheno_data, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x") 
summary(model_pcdf130_slope_cg11468953.fit.YB, fit = TRUE, rsquar = TRUE) # does converte!

```

# PCDF130 hubCpG of sig modules red

```{r medmodel hubCpG red}

# covariate preselection

corrmatrixM_pcdf130_cg18901378 <- as.matrix(subset(pheno_data, select = c(cg18901378, sex_n, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, CD4T, CD8T, Mono, NK, Gran, Bcell, AMP_Plate)))
rcorr(corrmatrixM_pcdf130_cg18901378)$P[, "cg18901378"] # p < .05 including in following mediation model

corrtable_pcdf130_red_hubCpG <- as.data.frame(corstarsl(corrmatrixM_pcdf130_cg18901378)[2:15,1])
colnames(corrtable_pcdf130_red_hubCpG) <- "hubCpG (red module)"
rownames(corrtable_pcdf130_red_hubCpG) <- c("neonate압 sex", "mother압 age at birth", "gestational length", "mother압 smoking status during pregnancy", "neonate압 birth weight", "mother압 education level", "mother압 BMI before pregnancy", "CD4T fraction", "CD8T fraction", "monocyte fraction", "NK fraction", "granulocyte fraction", "Bcell fraction", "EPIC assay plate")
corrtable_covvarhubCpG <- cbind(corrtable_covvarhubCpG, corrtable_pcdf130_red_hubCpG)


skew(pheno_data$cg18901378)
kurtosis(pheno_data$cg18901378)

# model selection
model_pcdf130_cg18901378ee <- '
          slopeDiffU15U6 ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg18901378 + age_m + AMP_Plate
          cg18901378 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + age_m + AMP_Plate
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_cg18901378.fit.YBee <- sem(model_pcdf130_cg18901378ee, data = pheno_data, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_cg18901378.fit.YBee, fit = TRUE, rsquar = TRUE)

# final model
model_pcdf130_cg18901378 <- '
          slopeDiffU15U6 ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg18901378 + age_m + AMP_Plate
          cg18901378 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + age_m + AMP_Plate
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_cg18901378.fit.YB <- sem(model_pcdf130_cg18901378, data = pheno_data, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_cg18901378.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdf130_cg18901378.fit.YB, ci = T, boot.ci.type = "bca.simple")


model_pcdf130_slope_cg18901378 <- '
          slopePDS ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg18901378 + age_m + AMP_Plate
          cg18901378 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + age_m + AMP_Plate
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_slope_cg18901378.fit.YB <- sem(model_pcdf130_slope_cg18901378, data = pheno_data, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_slope_cg18901378.fit.YB, fit = TRUE, rsquar = TRUE) # doesnt converte!
parameterEstimates(model_pcdf130_slope_cg18901378.fit.YB, ci = T, boot.ci.type = "bca.simple")

```

# PCDF130 hubCpG of sig modules salmon

```{r medmodel hubCpG salmon}

# covariate preselection

corrmatrixM_pcdf130_cg01733928 <- as.matrix(subset(pheno_data, select = c(cg01733928
, sex_n, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, CD4T, CD8T, Mono, NK, Gran, Bcell, AMP_Plate)))
rcorr(corrmatrixM_pcdf130_cg01733928)$P[, "cg01733928"] # p < .05 including in following mediation model

corrtable_pcdf130_salmon_hubCpG <- as.data.frame(corstarsl(corrmatrixM_pcdf130_cg01733928)[2:15,1])
colnames(corrtable_pcdf130_salmon_hubCpG) <- "hubCpG (salmon module)"
rownames(corrtable_pcdf130_salmon_hubCpG) <- c("neonate압 sex", "mother압 age at birth", "gestational length", "mother압 smoking status during pregnancy", "neonate압 birth weight", "mother압 education level", "mother압 BMI before pregnancy", "CD4T fraction", "CD8T fraction", "monocyte fraction", "NK fraction", "granulocyte fraction", "Bcell fraction", "EPIC assay plate")
corrtable_covvarhubCpG <- cbind(corrtable_covvarhubCpG, corrtable_pcdf130_salmon_hubCpG)

skew(pheno_data$cg01733928)
kurtosis(pheno_data$cg01733928)

# model selection
model_pcdf130_cg01733928ee <- '
          slopeDiffU15U6 ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg01733928 + age_m + AMP_Plate
          cg01733928 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + age_m + AMP_Plate
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_cg01733928.fit.YBee <- sem(model_pcdf130_cg01733928ee, data = pheno_data, se = "bootstrap",test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_cg01733928.fit.YBee, fit = TRUE, rsquar = TRUE)

# final model
model_pcdf130_cg01733928 <- '
          slopeDiffU15U6 ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg01733928 + age_m + AMP_Plate
          cg01733928 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + age_m + AMP_Plate
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_cg01733928.fit.YB <- sem(model_pcdf130_cg01733928, data = pheno_data, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_cg01733928.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdf130_cg01733928.fit.YB, ci = T, boot.ci.type = "bca.simple")


model_pcdf130_slope_cg01733928 <- '
          slopePDS ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg01733928 + age_m + AMP_Plate
          cg01733928 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + age_m + AMP_Plate
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_slope_cg01733928.fit.YB <- sem(model_pcdf130_slope_cg01733928, data = pheno_data, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x") 
summary(model_pcdf130_slope_cg01733928.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!

```

# PCDF130 hubCpG of sig modules white

```{r medmodel hubCpG white}

# covariate preselection

corrmatrixM_pcdf130_cg10482044 <- as.matrix(subset(pheno_data, select = c(cg10482044
, sex_n, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, CD4T, CD8T, Mono, NK, Gran, Bcell, AMP_Plate)))
rcorr(corrmatrixM_pcdf130_cg10482044)$P[, "cg10482044"] # p < .05 including in following mediation model

corrtable_pcdf130_white_hubCpG <- as.data.frame(corstarsl(corrmatrixM_pcdf130_cg10482044)[2:15,1])
colnames(corrtable_pcdf130_white_hubCpG) <- "hubCpG (white module)"
rownames(corrtable_pcdf130_white_hubCpG) <- c("neonate압 sex", "mother압 age at birth", "gestational length", "mother압 smoking status during pregnancy", "neonate압 birth weight", "mother압 education level", "mother압 BMI before pregnancy", "CD4T fraction", "CD8T fraction", "monocyte fraction", "NK fraction", "granulocyte fraction", "Bcell fraction", "EPIC assay plate")
corrtable_covvarhubCpG <- cbind(corrtable_covvarhubCpG, corrtable_pcdf130_white_hubCpG)


skew(pheno_data$cg10482044)
kurtosis(pheno_data$cg10482044)

# model selection
model_pcdf130_cg10482044eeeee <- '
          slopeDiffU15U6 ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg10482044 + highEduc_m_r + CD4T + Gran + Bcell + AMP_Plate
          cg10482044 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + highEduc_m_r + CD4T + CD4T + Gran + Bcell + AMP_Plate
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_cg10482044.fit.YBeeeee <- sem(model_pcdf130_cg10482044eeeee, data = pheno_data, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_cg10482044.fit.YBeeeee, fit = TRUE, rsquar = TRUE)

model_pcdf130_cg10482044eeee <- '
          slopeDiffU15U6 ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg10482044 + highEduc_m_r + CD4T + Bcell + AMP_Plate
          cg10482044 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + highEduc_m_r + CD4T + CD4T + Bcell + AMP_Plate
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_cg10482044.fit.YBeeee <- sem(model_pcdf130_cg10482044eeee, data = pheno_data, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_cg10482044.fit.YBeeee, fit = TRUE, rsquar = TRUE)

model_pcdf130_cg10482044eee <- '
          slopeDiffU15U6 ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg10482044 + highEduc_m_r + Bcell + AMP_Plate
          cg10482044 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + highEduc_m_r + Bcell + AMP_Plate
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_cg10482044.fit.YBeee <- sem(model_pcdf130_cg10482044eee, data = pheno_data, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_cg10482044.fit.YBeee, fit = TRUE, rsquar = TRUE)

# final model
model_pcdf130_cg10482044 <- '
          slopeDiffU15U6 ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg10482044 + highEduc_m_r + Bcell + AMP_Plate
          cg10482044 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + highEduc_m_r + Bcell + AMP_Plate
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_cg10482044.fit.YB <- sem(model_pcdf130_cg10482044, data = pheno_data, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_cg10482044.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdf130_cg10482044.fit.YB, ci = T, boot.ci.type = "bca.simple")


model_pcdf130_slope_cg10482044 <- '
          slopePDS ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg10482044 + highEduc_m_r + Bcell + AMP_Plate 
          cg10482044 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + highEduc_m_r + Bcell + AMP_Plate
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_slope_cg10482044.fit.YB <- sem(model_pcdf130_slope_cg10482044, data = pheno_data, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x") 
summary(model_pcdf130_slope_cg10482044.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!

```

# PCDF130 hubCpG of sig modules yellow

```{r medmodel hubCpG yellow}

# covariate preselection

corrmatrixM_pcdf130_cg09941484 <- as.matrix(subset(pheno_data, select = c(cg09941484
, sex_n, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, CD4T, CD8T, Mono, NK, Gran, Bcell, AMP_Plate)))
rcorr(corrmatrixM_pcdf130_cg09941484)$P[, "cg09941484"] # p < .05 including in following mediation model

corrtable_pcdf130_yellow_hubCpG <- as.data.frame(corstarsl(corrmatrixM_pcdf130_cg09941484)[2:15,1])
colnames(corrtable_pcdf130_yellow_hubCpG) <- "hubCpG (yellow module)"
rownames(corrtable_pcdf130_yellow_hubCpG) <- c("neonate압 sex", "mother압 age at birth", "gestational length", "mother압 smoking status during pregnancy", "neonate압 birth weight", "mother압 education level", "mother압 BMI before pregnancy", "CD4T fraction", "CD8T fraction", "monocyte fraction", "NK fraction", "granulocyte fraction", "Bcell fraction", "EPIC assay plate")
corrtable_covvarhubCpG <- cbind(corrtable_covvarhubCpG, corrtable_pcdf130_yellow_hubCpG)

#write.csv2(corrtable_covvarhubCpG, file = "path/mediation_WGCNA_corrtable_covvarhubCpG_all_N142.csv")

skew(pheno_data$cg09941484)
kurtosis(pheno_data$cg09941484)

# model selection
model_pcdf130_cg09941484eee <- '
          slopeDiffU15U6 ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg09941484 + highEduc_m_r + Bcell + AMP_Plate
          cg09941484 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + highEduc_m_r + Bcell + AMP_Plate
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_cg09941484.fit.YBeee <- sem(model_pcdf130_cg09941484eee, data = pheno_data, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_cg09941484.fit.YBeee, fit = TRUE, rsquar = TRUE)

model_pcdf130_cg09941484ee <- '
          slopeDiffU15U6 ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg09941484 + Bcell + AMP_Plate
          cg09941484 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + Bcell + AMP_Plate
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_cg09941484.fit.YBee <- sem(model_pcdf130_cg09941484ee, data = pheno_data, se = "bootstrap", test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_cg09941484.fit.YBee, fit = TRUE, rsquar = TRUE)

# final model
model_pcdf130_cg09941484 <- '
          slopeDiffU15U6 ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg09941484 + Bcell + AMP_Plate
          cg09941484 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + Bcell + AMP_Plate
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_cg09941484.fit.YB <- sem(model_pcdf130_cg09941484, data = pheno_data, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_cg09941484.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdf130_cg09941484.fit.YB, ci = T, boot.ci.type = "bca.simple")


model_pcdf130_slope_cg09941484 <- '
          slopePDS ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*cg09941484 + Bcell + AMP_Plate
          cg09941484 ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n + Bcell + AMP_Plate
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_slope_cg09941484.fit.YB <- sem(model_pcdf130_slope_cg09941484, data = pheno_data, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_slope_cg09941484.fit.YB, fit = TRUE, rsquar = TRUE) # doesn앖 converte
parameterEstimates(model_pcdf130_slope_cg09941484.fit.YB, ci = T, boot.ci.type = "bca.simple")

```

# export results to tables (& figures)

```{r export results}

l_pcdf130_brown_f <- parameterEstimates(model_pcdf130_brown_f.fit.YB)[c(1:7, 11:12, 14), ]
l_pcdf130_brown_f
b_pcdf130_brown_f <- gettextf('%s %.2f p=%.2f', l_pcdf130_brown_f$label, l_pcdf130_brown_f$est, digits = l_pcdf130_brown_f$pvalue)
b_pcdf130_brown_f <- gsub(".*p=NA.*", "", b_pcdf130_brown_f)
b_pcdf130_brown_f <- gsub("w", "*sex", b_pcdf130_brown_f)
b_pcdf130_brown_f
semPaths(model_pcdf130_brown_f.fit.YB, what= "path", whatLabels = "est", intercepts = FALSE, rotation = 2)
semPaths(model_pcdf130_brown_f.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf130_brown_f, label.prop = 1,  edge.label.bg = TRUE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "EigenCpG\nbrown", "PCDF130", "B-cells", "EPIC\narray\nplate"), edge.label.position = .7, edge.width = .6, node.width = 1.5, curve = 2)

l_pcdf130_lightcyan1_f <- parameterEstimates(model_pcdf130_lightcyan1_f.fit.YB)[c(1:11, 15:18, 20:22, 24:25, 27), ]
l_pcdf130_lightcyan1_f
b_pcdf130_lightcyan1_f <- gettextf('%s %.2f\np=%.2f', l_pcdf130_lightcyan1_f$label, l_pcdf130_lightcyan1_f$est, digits = l_pcdf130_lightcyan1_f$pvalue)
b_pcdf130_lightcyan1_f <- gsub(".*\np=NA.*", "", b_pcdf130_lightcyan1_f)
b_pcdf130_lightcyan1_f <- gsub("w", "*sex", b_pcdf130_lightcyan1_f)
b_pcdf130_lightcyan1_f
semPaths(model_pcdf130_lightcyan1_f.fit.YB, what= "path", whatLabels = "est", intercepts = FALSE, rotation = 2)
semPaths(model_pcdf130_lightcyan1_f.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf130_lightcyan1_f, label.prop = 1,  edge.label.bg = TRUE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "EigenCpG\nlightcyan1", "PCDF130", "CD4T", "NK", "granulo-\ncytes", "B-cells"), edge.label.position = .7, edge.width = .6, node.width = 1.5, curve = 2)

l_pcdf130_red_f <- parameterEstimates(model_pcdf130_red_f.fit.YB)[c(1:5, 9), ]
l_pcdf130_red_f
b_pcdf130_red_f <- gettextf('%s %.2f\np=%.2f', l_pcdf130_red_f$label, l_pcdf130_red_f$est, digits = l_pcdf130_red_f$pvalue)
b_pcdf130_red_f <- gsub(".*p=NA.*", "", b_pcdf130_red_f)
b_pcdf130_red_f <- gsub("w", "*sex", b_pcdf130_red_f)
b_pcdf130_red_f
semPaths(model_pcdf130_red_f.fit.YB, what= "path", whatLabels = "est", intercepts = FALSE, rotation = 2)
semPaths(model_pcdf130_red_f.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf130_red_f, label.prop = 1,  edge.label.bg = TRUE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "EigenCpG\nred", "PCDF130", "EPIC\narray\nplate"), edge.label.position = .7, edge.width = .6, node.width = 1.5, curve = 2)

l_pcdf130_salmon_f <- parameterEstimates(model_pcdf130_salmon_f.fit.YB)[c(1:7, 11:12, 14), ]
l_pcdf130_salmon_f
b_pcdf130_salmon_f <- gettextf('%s %.2f\np=%.2f', l_pcdf130_salmon_f$label, l_pcdf130_salmon_f$est, digits = l_pcdf130_salmon_f$pvalue)
b_pcdf130_salmon_f <- gsub(".*p=NA.*", "", b_pcdf130_salmon_f)
b_pcdf130_salmon_f <- gsub("w", "*sex", b_pcdf130_salmon_f)
b_pcdf130_salmon_f
semPaths(model_pcdf130_salmon_f.fit.YB, what= "path", whatLabels = "est", intercepts = FALSE, rotation = 2)
semPaths(model_pcdf130_salmon_f.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf130_salmon_f, label.prop = 1,  edge.label.bg = TRUE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "EigenCpG\nsalmon", "PCDF130", "B-cells", "EPIC\narray\nplate"), edge.label.position = .7, edge.width = .6, node.width = 1.5, curve = 2)

l_pcdf130_salmon_f_slope <- parameterEstimates(model_pcdf130_slope_salmon_f.fit.YB)[c(1:7, 11:12, 14), ]
l_pcdf130_salmon_f_slope
b_pcdf130_salmon_f_slope <- gettextf('%s %.2f\np=%.2f', l_pcdf130_salmon_f_slope$label, l_pcdf130_salmon_f_slope$est, digits = l_pcdf130_salmon_f_slope$pvalue)
b_pcdf130_salmon_f_slope <- gsub(".*p=NA.*", "", b_pcdf130_salmon_f_slope)
b_pcdf130_salmon_f_slope <- gsub("w", "*sex", b_pcdf130_salmon_f_slope)
b_pcdf130_salmon_f_slope
semPaths(model_pcdf130_slope_salmon_f.fit.YB, what= "path", whatLabels = "est", intercepts = FALSE, rotation = 2)
semPaths(model_pcdf130_slope_salmon_f.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf130_salmon_f_slope, label.prop = 1,  edge.label.bg = TRUE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("longitu.\npubertal.\ndevelop.", "EigenCpG\nsalmon", "PCDF130", "B-cells", "EPIC\narray\nplate"), edge.label.position = .7, edge.width = .6, node.width = 1.5, curve = 2)

l_pcdf130_white_f <- parameterEstimates(model_pcdf130_white_f.fit.YB)[c(1:7, 11:12, 14), ]
l_pcdf130_white_f
b_pcdf130_white_f <- gettextf('%s %.2f\np=%.2f', l_pcdf130_white_f$label, l_pcdf130_white_f$est, digits = l_pcdf130_white_f$pvalue)
b_pcdf130_white_f <- gsub(".*p=NA.*", "", b_pcdf130_white_f)
b_pcdf130_white_f <- gsub("w", "*sex", b_pcdf130_white_f)
b_pcdf130_white_f
semPaths(model_pcdf130_white_f.fit.YB, what= "path", whatLabels = "est", intercepts = FALSE, rotation = 2)
semPaths(model_pcdf130_white_f.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf130_white_f, label.prop = 1,  edge.label.bg = TRUE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "EigenCpG\nwhite", "PCDF130", "CD4T", "B-cells"), edge.label.position = .7, edge.width = .6, node.width = 1.5, curve = 2)

l_pcdf130_yellow_f <- parameterEstimates(model_pcdf130_yellow_f.fit.YB)[c(1:5, 10), ]
l_pcdf130_yellow_f
b_pcdf130_yellow_f <- gettextf('%s %.2f\np=%.2f', l_pcdf130_yellow_f$label, l_pcdf130_yellow_f$est, digits = l_pcdf130_yellow_f$pvalue)
b_pcdf130_yellow_f <- gsub("\np=NA", "", b_pcdf130_yellow_f)
b_pcdf130_yellow_f <- gsub("w", "*sex", b_pcdf130_yellow_f)
b_pcdf130_yellow_f
semPaths(model_pcdf130_yellow_f.fit.YB, what= "path", whatLabels = "est", intercepts = FALSE, rotation = 2)
semPaths(model_pcdf130_yellow_f.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf130_yellow_f, label.prop = 1,  edge.label.bg = TRUE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "EigenCpG\nyellow", "PCDF130", "B-cells"), edge.label.position = .7, edge.width = .6, node.width = 1.5, curve = 2)

l_pcdf130_brown <- parameterEstimates(model_pcdf130_cg09899564.fit.YB)[c(1:7, 11:12, 14), ]
l_pcdf130_brown
b_pcdf130_brown <- gettextf('%s %.2f p=%.2f', l_pcdf130_brown$label, l_pcdf130_brown$est, digits = l_pcdf130_brown$pvalue)
b_pcdf130_brown <- gsub(".*p=NA.*", "", b_pcdf130_brown)
b_pcdf130_brown <- gsub("w", "*sex", b_pcdf130_brown)
b_pcdf130_brown
semPaths(model_pcdf130_cg09899564.fit.YB, what= "path", whatLabels = "est", intercepts = FALSE, rotation = 2)
semPaths(model_pcdf130_cg09899564.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf130_brown, edge.label.bg = TRUE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "hubCpG\nbrown", "PCDF130", "child압\nsex", "PCDF130*\nchild압 sex", "B-cells"), edge.label.position = .6, edge.width = .6, node.width = 1.7, curve = 2)

l_pcdf130_lightcyan1 <- parameterEstimates(model_pcdf130_cg11468953.fit.YB)[c(1:11, 15:18, 20:22, 24:25, 27), ]
l_pcdf130_lightcyan1
b_pcdf130_lightcyan1 <- gettextf('%s %.2f p=%.2f', l_pcdf130_lightcyan1$label, l_pcdf130_lightcyan1$est, digits = l_pcdf130_lightcyan1$pvalue)
b_pcdf130_lightcyan1 <- gsub(".*p=NA.*", "", b_pcdf130_lightcyan1)
b_pcdf130_lightcyan1 <- gsub("w", "*sex", b_pcdf130_lightcyan1)
b_pcdf130_lightcyan1
semPaths(model_pcdf130_cg11468953.fit.YB, what= "path", whatLabels = "est", intercepts = FALSE, rotation = 2)
semPaths(model_pcdf130_cg11468953.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf130_lightcyan1, edge.label.bg = TRUE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "hubCpG\nlightcyan1", "PCDF130", "child압\nsex", "PCDF130*\nchild압 sex", "CD4T", "B-cells"), edge.label.position = .6, edge.width = .6, node.width = 1.7, curve = 2)

l_pcdf130_lightcyan1_slope <- parameterEstimates(model_pcdf130_slope_cg11468953.fit.YB)[c(1:11, 15:18, 20:22, 24:25, 27), ]
l_pcdf130_lightcyan1_slope
b_pcdf130_lightcyan1_slope <- gettextf('%s %.2f p=%.2f', l_pcdf130_lightcyan1_slope$label, l_pcdf130_lightcyan1_slope$est, digits = l_pcdf130_lightcyan1_slope$pvalue)
b_pcdf130_lightcyan1_slope <- gsub(".*p=NA.*", "", b_pcdf130_lightcyan1_slope)
b_pcdf130_lightcyan1_slope <- gsub("w", "*sex", b_pcdf130_lightcyan1_slope)
b_pcdf130_lightcyan1_slope
semPaths(model_pcdf130_slope_cg11468953.fit.YB, what= "path", whatLabels = "est", intercepts = FALSE, rotation = 2)
semPaths(model_pcdf130_slope_cg11468953.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf130_lightcyan1_slope, edge.label.bg = TRUE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("longitud.\npubert.\ndevelop.", "hubCpG\nlightcyan1", "PCDF130", "child압\nsex", "PCDF130*\nchild압 sex", "CD4T", "B-cells"), edge.label.position = .6, edge.width = .6, node.width = 1.7, curve = 2)

l_pcdf130_red <- parameterEstimates(model_pcdf130_cg18901378.fit.YB)[c(1:11, 15:18, 20:22, 24:25, 27), ]
l_pcdf130_red
b_pcdf130_red <- gettextf('%s %.2f p=%.2f', l_pcdf130_red$label, l_pcdf130_red$est, digits = l_pcdf130_red$pvalue)
b_pcdf130_red <- gsub(".*p=NA.*", "", b_pcdf130_red)
b_pcdf130_red <- gsub("w", "*sex", b_pcdf130_red)
b_pcdf130_red
semPaths(model_pcdf130_cg18901378.fit.YB, what= "path", whatLabels = "est", intercepts = FALSE, rotation = 2)
semPaths(model_pcdf130_cg18901378.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf130_red, edge.label.bg = TRUE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "hubCpG\nred", "PCDF130", "child압\nsex", "PCDF130*\nchild압 sex", "mother압\nage at\birth", "EPIC\narray\nplate"), edge.label.position = .6, edge.width = .6, node.width = 1.7, curve = 2)

l_pcdf130_salmon <- parameterEstimates(model_pcdf130_cg01733928.fit.YB)[c(1:11, 15:18, 20:22, 24:25, 27), ]
l_pcdf130_salmon
b_pcdf130_salmon <- gettextf('%s %.2f p=%.2f', l_pcdf130_salmon$label, l_pcdf130_salmon$est, digits = l_pcdf130_salmon$pvalue)
b_pcdf130_salmon <- gsub(".*p=NA.*", "", b_pcdf130_salmon)
b_pcdf130_salmon <- gsub("w", "*sex", b_pcdf130_salmon)
b_pcdf130_salmon
semPaths(model_pcdf130_cg01733928.fit.YB, what= "path", whatLabels = "est", intercepts = FALSE, rotation = 2)
semPaths(model_pcdf130_cg01733928.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf130_salmon, edge.label.bg = TRUE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "hubCpG\nsalmon", "PCDF130", "child압\nsex", "PCDF130*\nchild압 sex", "mother압\nage\nat birth", "EPIC\narray\nplate"), edge.label.position = .6, edge.width = .6, node.width = 1.7, curve = 2)

l_pcdf130_white <- parameterEstimates(model_pcdf130_cg10482044.fit.YB)[c(1:13, 17:21, 23:26, 28:30, 32:33, 35), ]
l_pcdf130_white
b_pcdf130_white <- gettextf('%s %.2f p=%.2f', l_pcdf130_white$label, l_pcdf130_white$est, digits = l_pcdf130_white$pvalue)
b_pcdf130_white <- gsub(".*p=NA.*", "", b_pcdf130_white)
b_pcdf130_white <- gsub("w", "*sex", b_pcdf130_white)
b_pcdf130_white
semPaths(model_pcdf130_cg10482044.fit.YB, what= "path", whatLabels = "est", intercepts = FALSE, rotation = 2)
semPaths(model_pcdf130_cg10482044.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf130_white, edge.label.bg = TRUE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "hubCpG\nwhite", "PCDF130", "child압\nsex", "PCDF130*\nchild압 sex", "mother압\neducation\nlevel", "B-cells", "EPIC\narray\nplate"), edge.label.position = .6, edge.width = .6, node.width = 1.7, curve = 2)

l_pcdf130_yellow <- parameterEstimates(model_pcdf130_cg09941484.fit.YB)[c(1:11, 15:18, 20:22, 24:25, 27), ]
l_pcdf130_yellow
b_pcdf130_yellow <- gettextf('%s %.2f p=%.2f', l_pcdf130_yellow$label, l_pcdf130_yellow$est, digits = l_pcdf130_yellow$pvalue)
b_pcdf130_yellow <- gsub(".*p=NA.*", "", b_pcdf130_yellow)
b_pcdf130_yellow <- gsub("w", "*sex", b_pcdf130_yellow)
b_pcdf130_yellow
semPaths(model_pcdf130_cg09941484.fit.YB, what= "path", whatLabels = "est", intercepts = FALSE, rotation = 2)
semPaths(model_pcdf130_cg09941484.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf130_yellow, edge.label.bg = TRUE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "hubCpG\nyellow", "PCDF130", "child압\nsex", "PCDF130*\nchild압 sex", "B-cells", "EPIC\narray\nplate"), edge.label.position = .6, edge.width = .6, node.width = 1.7, curve = 2)

```

# save

```{r save}

#save.image("path/mediation_WGCNA_image4.RData")

```