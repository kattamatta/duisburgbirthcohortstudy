---
title: "mediation_AR"
author: "Katharina Mattonet"
date: "22 Oktober 2020"
output: html_document
---

# load libraries

```{r load libraries}
library(dplyr)
library(lavaan)
library(Hmisc)
library(semPlot)
library(semTools)
library(emmeans)
library(interactions)
```

# load data

```{r load data}


#load("path/mediation_ESR2bisulfitseq_image2.RData") 

load(file = "paths/pheno_data_N164.RData")
all_data_new <- all_data
remove(all_data)

load(file = "path/predictedPDS.RData")

load(file = "path/preprocessed_ESR2.RData")

load(file = "path/PDS/BMI_kids.RData")


```

# prepare data

```{r prepare data}

all_data_new <- left_join(all_data_new, BMI, by = "B_StdNr")
BMI_red <- subset(all_data_new, select = c(D_StdNr, diffu11u6))
colnames(BMI_red)[2] <- "BMI_kids_diffu15u6" 

# sex combined

slopePDS <- data.frame(as.integer(all_data_wide$D_StdNr), all_data_wide$slopePDS, all_data_wide$PDS_diffU15U6)
colnames(slopePDS) <- c("D_StdNr", "slopePDS", "slopeDiffU15U6")
all_data_new <- left_join(all_data_new, slopePDS, by = "D_StdNr")
all_data_new <- left_join(all_data_new, BMI_red, by = "D_StdNr")

all_data_new <- all_data_new[ !(all_data_new$D_StdNr %in% c(45, 68, 77, 80, 127, 160, 162)), ] # remove 45: same serum sample number as 44 (B_Std_Nr: 72), 68 (other ethnicity): not matching a priori criteria, 77, 80, 127 & 160: no EDCs data, 162 (all ready excluded before data import): no sex of neonate, age of mother, duration gestation data


edc_lod_N157 <- data.frame(all_data_new$nonlog_PCB77, all_data_new$nonlog_PCB81, all_data_new$nonlog_PCB126, all_data_new$nonlog_PCB169, all_data_new$nonlog_PCB105, all_data_new$nonlog_PCB114, all_data_new$nonlog_PCB118, all_data_new$nonlog_PCB123, all_data_new$nonlog_PCB156, all_data_new$nonlog_PCB157, all_data_new$nonlog_PCB167, all_data_new$nonlog_PCB189, all_data_new$nonlog_PCB28, all_data_new$nonlog_PCB52, all_data_new$nonlog_PCB101, all_data_new$nonlog_PCB138, all_data_new$nonlog_PCB153, all_data_new$nonlog_PCB180, all_data_new$nonlog_PCDD48, all_data_new$nonlog_PCDD54, all_data_new$nonlog_PCDD66, all_data_new$nonlog_PCDD67, all_data_new$nonlog_PCDD70, all_data_new$nonlog_PCDD73, all_data_new$nonlog_PCDD75, all_data_new$nonlog_PCDF83, all_data_new$nonlog_PCDF94, all_data_new$nonlog_PCDF114, all_data_new$nonlog_PCDF118, all_data_new$nonlog_PCDF121, all_data_new$nonlog_PCDF130, all_data_new$nonlog_PCDF124, all_data_new$nonlog_PCDF131, all_data_new$nonlog_PCDF134, all_data_new$nonlog_PCDF135)

## which congeners has measure <= .5 >= 25%
for(i in 1:ncol(edc_lod_N157)) {
  if((length(which((round(edc_lod_N157[,i], digit = 1) <= 0.5) == TRUE))/157) > .25)
  print(colnames(edc_lod_N157)[i])
}

remove_congeners <- as.vector(c("PCB105", "PCB114", "PCB118", "PCB123", "PCB156", "PCB157", "PCB167", "PCB189", "PCB28", "PCB52", "PCB101", "PCB138", "PCB153", "PCB180", "PCDF83", "PCDF94", "PCDF124", "PCDF134","PCDF135"))

all_data_new <- as.data.frame(all_data_new[!(colnames(all_data_new) %in% remove_congeners)])

all_data_new$sex_n <- as.numeric(levels(all_data_new$sex_n))[all_data_new$sex_n]
all_data_new$smoke_m_r <- as.numeric(levels(all_data_new$smoke_m_r))[all_data_new$smoke_m_r]

all_data_new <- left_join(all_data_new, ESR2, by = "D_StdNr")

```


# explore data

```{r explore data}

cor_table_cpgs <- all_data_new[, c("CpG-82_b" , "CpG-80_b", "CpG-78_b", "CpG-75_b", "CpG-72_b", "CpG-68_b", "CpG-56_b", "CpG-53_b")]
descriptive_CpG_betas <- psych::describe(cor_table_cpgs)
descriptive_CpG_meanb <- psych::describe(all_data_new$Mean_b)
descriptive_CpGs_ESR2 <- rbind(descriptive_CpG_betas, descriptive_CpG_meanb)
rownames(descriptive_CpGs_ESR2)[9] <- "meanCpGs"
#write.csv2(descriptive_CpGs_ESR2, file = "path/descriptive_CpGs_ESR2.csv")

## crate APA-table of correlation matrix
### function
corstarsl <- function(x){
require(Hmisc)
x <- as.matrix(x)
R <- rcorr(x)$r
p <- rcorr(x)$P
p <- round(p, digits = 2)

## define notions for significance levels; spacing is important.
mystars <- ifelse(p < .01, "**", ifelse(p < .05, "*", " "))

## trunctuate the matrix that holds the correlations to two decimal
R <- format(round(cbind(rep(-1.11, ncol(x)), R), 2))[,-1]

## build a new matrix that includes the correlations with their apropriate stars
Rnew <- matrix(paste(R, mystars, sep=""), ncol=ncol(x))
diag(Rnew) <- paste(diag(R), " ", sep="")
rownames(Rnew) <- colnames(x)
colnames(Rnew) <- paste(colnames(x), "", sep="")

## remove upper triangle
Rnew <- as.matrix(Rnew)
Rnew[upper.tri(Rnew, diag = TRUE)] <- ""
Rnew <- as.data.frame(Rnew)

## remove last column and return the matrix (which is now a data frame)
Rnew <- cbind(Rnew[1:length(Rnew)-1])
return(Rnew)
}

cor<- Hmisc::rcorr(as.matrix(cor_table_cpgs))
cor$P # all r sig -> mean beta okay!
corrtable_ESR2_apa <- as.data.frame(corstarsl(cor_table_cpgs))
#write.csv2(corrtable_ESR2_apa, file = "path/corrtable_ESR2_apa.csv")


corrmatrixY <- as.matrix(subset(all_data_new, select = c(slopeDiffU15U6, sex_n, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, BMI_kids_diffu15u6)))
rcorr(corrmatrixY)$P[, 1] # p <= .05 (rounded) including in following mediation model ## smoke_m_r 

corrmatrixM <- as.matrix(subset(all_data_new, select = c(Mean_M, sex_n, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m)))
rcorr(corrmatrixM)$P[, 1] # p <= .05 (rounded) including in following mediation model ## non 
t.test(all_data_new$Mean_M ~ all_data_new$sex_n) #ns
aggregate(Mean_b ~ sex_n, data = all_data_new, FUN = mean) 
aggregate(Mean_b ~ sex_n, data = all_data_new, FUN = sd) 

# Y = slopePDS
corrmatrixYslope <- as.matrix(subset(all_data_new, select = c(slopePDS, sex_n, age_m, dur_gest, smoke_m_r, weight_n, highEduc_m_r, BMI_m, BMI_kids_diffu15u6)))
rcorr(corrmatrixYslope)$P[, 1] # p <= .05 (rounded) including in following mediation model ## non

corrtableXM <- as.data.frame(corstarsl(corrmatrixM)[2:8,1])
colnames(corrtableXM) <- "ESR2 (N=157)"
rownames(corrtableXM) <- c("neonate큦 sex", "mother큦 age at birth", "gestational length", "mother큦 smoking status during pregnancy", "neonate큦 birth weight", "mother큦 education level", "mother큦 BMI before pregnancy")
corrtableXM

#write.csv2(corrtableXM, file = "path/mediation_ESR1bisulfiteseq_corrtable_covvar_ESR2_N157.csv")

```

# set seed for replication

```{r seed}

set.seed(123)

```

# check data for normal distribution

```{r check data}
var(all_data_new$slopePDS, na.rm = TRUE) # 0.002248299, use slopeDiffU15U6 as outcome in main models
length(which(is.na(all_data_new$slopeDiffU15U6))) 
length(which(is.na(all_data_new$slopePDS))) 
length(which(is.na(all_data_new$Mean_M))) 
length(which(is.na(all_data_new$sex_n))) 

skew(all_data_new$slopePDS)
kurtosis(all_data_new$slopePDS)
skew(all_data_new$slopeDiffU15U6)
kurtosis(all_data_new$slopeDiffU15U6)
skew(all_data_new$Mean_M)
kurtosis(all_data_new$Mean_M)
# not normal distributed data -> use robust test of satorra.bentler 
```


# PCB77 - mediation model 

```{r medmodel pcb77}

all_data_new$PCB77c <- scale(all_data_new$PCB77, center = TRUE, scale = FALSE)

skew(all_data_new$PCB77c)
kurtosis(all_data_new$PCB77c)
# not normal distributed data

model_pcb77 <- '
          slopeDiffU15U6 ~ c*PCB77c + sex_n + cw*PCB77c:sex_n + b*Mean_M
          Mean_M ~ a*PCB77c + sex_n + aw*PCB77c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcb77.fit.YB <- sem(model_pcb77, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcb77.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcb77.fit.YB, ci = T, boot.ci.type = "bca.simple")


model_pcb77_slope <- '
          slopePDS ~ c*PCB77c + sex_n + cw*PCB77c:sex_n + b*Mean_M 
          Mean_M ~ a*PCB77c + sex_n + aw*PCB77c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcb77_slope.fit.YB <- sem(model_pcb77_slope, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcb77_slope.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!

```

# PCB81 - mediation model 

```{r medmodel pcb81}

all_data_new$PCB81c <- scale(all_data_new$PCB81, center = TRUE, scale = FALSE)

skew(all_data_new$PCB81c)
kurtosis(all_data_new$PCB81c)

model_pcb81 <- '
          slopeDiffU15U6 ~ c*PCB81c + sex_n + cw*PCB81c:sex_n + b*Mean_M
          Mean_M ~ a*PCB81c + sex_n + aw*PCB81c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcb81.fit.YB <- sem(model_pcb81, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcb81.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcb81.fit.YB, ci = T, boot.ci.type = "bca.simple")


model_pcb81_slope <- '
          slopePDS ~ c*PCB81c + sex_n + cw*PCB81c:sex_n + b*Mean_M
          Mean_M ~ a*PCB81c + sex_n + aw*PCB81c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcb81_slope.fit.YB <- sem(model_pcb81_slope, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcb81_slope.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!

```

# PCB126 - mediation model 

```{r medmodel pcb126}

all_data_new$PCB126c <- scale(all_data_new$PCB126, center = TRUE, scale = FALSE)

skew(all_data_new$PCB126c)
kurtosis(all_data_new$PCB126c)

model_pcb126 <- '
          slopeDiffU15U6 ~ c*PCB126c + sex_n + cw*PCB126c:sex_n + b*Mean_M
          Mean_M ~ a*PCB126c + sex_n + aw*PCB126c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcb126.fit.YB <- sem(model_pcb126, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcb126.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcb126.fit.YB, ci = T, boot.ci.type = "bca.simple")


model_pcb126_slope <- '
          slopePDS ~ c*PCB126c + sex_n + cw*PCB126c:sex_n + b*Mean_M
          Mean_M ~ a*PCB126c + sex_n + aw*PCB126c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcb126_slope.fit.YB <- sem(model_pcb126_slope, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcb126_slope.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!

```

# PCB169 - mediation model 

```{r medmodel pcb169}

all_data_new$PCB169c <- scale(all_data_new$PCB169, center = TRUE, scale = FALSE)

skew(all_data_new$PCB169c)
kurtosis(all_data_new$PCB169c)

model_pcb169 <- '
          slopeDiffU15U6 ~ c*PCB169c + sex_n + cw*PCB169c:sex_n + b*Mean_M
          Mean_M ~ a*PCB169c + sex_n + aw*PCB169c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcb169.fit.YB <- sem(model_pcb169, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcb169.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcb169.fit.YB, ci = T, boot.ci.type = "bca.simple")

## test conditional sex effect
### c-path
cond_model_pcb169_cpath <- glm(slopeDiffU15U6 ~ PCB169c * sex_n, data = all_data_new)
cond_effects_pcb169_cpath <- emtrends(cond_model_pcb169_cpath, var = "PCB169c", specs = "sex_n")
cond_effects_pcb169_cpath
# Inf, since test and confidence intervals are asymptotic (https://cran.r-project.org/web/packages/emmeans/vignettes/models.html#G) & Sets all the degrees of freedom to Inf -- that's emmeans's way of using z statistics rather than t statistics (https://rdrr.io/cran/emmeans/f/vignettes/sophisticated.Rmd)
pairs(cond_effects_pcb169_cpath)
interact_plot(cond_model_pcb169_cpath, pred = PCB169c, modx = sex_n, plot.points = TRUE, point.shape = TRUE, interval = TRUE, x.label = "PCB169", y.label = "PDS score (t5-t0)", modx.labels = c("female", "male"), legend.main = "Sex")
#write.csv2(cond_effects_pcb169_cpath, file = "path/cpath_pcb169.csv")


model_pcb169_slope <- '
          slopePDS ~ c*PCB169c + sex_n + cw*PCB169c:sex_n + b*Mean_M
          Mean_M ~ a*PCB169c + sex_n + aw*PCB169c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcb169_slope.fit.YB <- sem(model_pcb169_slope, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcb169_slope.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!

```

# PCDD48 - mediation model 

```{r medmodel pcdd48}

all_data_new$PCDD48c <- scale(all_data_new$PCDD48, center = TRUE, scale = FALSE)

skew(all_data_new$PCDD48c)
kurtosis(all_data_new$PCDD48c)

model_pcdd48 <- '
          slopeDiffU15U6 ~ c*PCDD48c + sex_n + cw*PCDD48c:sex_n + b*Mean_M
          Mean_M ~ a*PCDD48c + sex_n + aw*PCDD48c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdd48.fit.YB <- sem(model_pcdd48, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdd48.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdd48.fit.YB, ci = T, boot.ci.type = "bca.simple")


model_pcdd48_slope <- '
          slopePDS ~ c*PCDD48c + sex_n + cw*PCDD48c:sex_n + b*Mean_M
          Mean_M ~ a*PCDD48c + sex_n + aw*PCDD48c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdd48_slope.fit.YB <- sem(model_pcdd48_slope, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdd48_slope.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!

```

# PCDD54 - mediation model 

```{r medmodel pcdd54}

all_data_new$PCDD54c <- scale(all_data_new$PCDD54, center = TRUE, scale = FALSE)

skew(all_data_new$PCDD54c)
kurtosis(all_data_new$PCDD54c)

model_pcdd54 <- '
          slopeDiffU15U6 ~ c*PCDD54c + sex_n + cw*PCDD54c:sex_n + b*Mean_M
          Mean_M ~ a*PCDD54c + sex_n + aw*PCDD54c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdd54.fit.YB <- sem(model_pcdd54, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdd54.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdd54.fit.YB, ci = T, boot.ci.type = "bca.simple")


model_pcdd54_slope <- '
          slopePDS ~ c*PCDD54c + sex_n + cw*PCDD54c:sex_n + b*Mean_M
          Mean_M ~ a*PCDD54c + sex_n + aw*PCDD54c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdd54_slope.fit.YB <- sem(model_pcdd54_slope, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdd54_slope.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!
```

# PCDD66 - mediation model 

```{r medmodel pcdd66}

all_data_new$PCDD66c <- scale(all_data_new$PCDD66, center = TRUE, scale = FALSE)

skew(all_data_new$PCDD66c)
kurtosis(all_data_new$PCDD66c)

model_pcdd66 <- '
          slopeDiffU15U6 ~ c*PCDD66c + sex_n + cw*PCDD66c:sex_n + b*Mean_M
          Mean_M ~ a*PCDD66c + sex_n + aw*PCDD66c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdd66.fit.YB <- sem(model_pcdd66, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdd66.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdd66.fit.YB, ci = T, boot.ci.type = "bca.simple")


model_pcdd66_slope <- '
          slopePDS ~ c*PCDD66c + sex_n + cw*PCDD66c:sex_n + b*Mean_M
          Mean_M ~ a*PCDD66c + sex_n + aw*PCDD66c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdd66_slope.fit.YB <- sem(model_pcdd66_slope, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdd66_slope.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!

```

# PCDD67 - mediation model 

```{r medmodel pcdd67}

all_data_new$PCDD67c <- scale(all_data_new$PCDD67, center = TRUE, scale = FALSE)

skew(all_data_new$PCDD67c)
kurtosis(all_data_new$PCDD67c)

model_pcdd67 <- '
          slopeDiffU15U6 ~ c*PCDD67c + sex_n + cw*PCDD67c:sex_n + b*Mean_M
          Mean_M ~ a*PCDD67c + sex_n + aw*PCDD67c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdd67.fit.YB <- sem(model_pcdd67, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdd67.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdd67.fit.YB, ci = T, boot.ci.type = "bca.simple")


model_pcdd67_slope <- '
          slopePDS ~ c*PCDD67c + sex_n + cw*PCDD67c:sex_n + b*Mean_M
          Mean_M ~ a*PCDD67c + sex_n + aw*PCDD67c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdd67_slope.fit.YB <- sem(model_pcdd67_slope, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdd67_slope.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!

```


# PCDD70 - mediation model 

```{r medmodel pcdd70}

all_data_new$PCDD70c <- scale(all_data_new$PCDD70, center = TRUE, scale = FALSE)

skew(all_data_new$PCDD70c)
kurtosis(all_data_new$PCDD70c)

model_pcdd70 <- '
          slopeDiffU15U6 ~ c*PCDD70c + sex_n + cw*PCDD70c:sex_n + b*Mean_M
          Mean_M ~ a*PCDD70c + sex_n + aw*PCDD70c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdd70.fit.YB <- sem(model_pcdd70, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdd70.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdd70.fit.YB, ci = T, boot.ci.type = "bca.simple")

## test conditional sex effect
### c-path
cond_model_pcdd70_cpath <- glm(slopeDiffU15U6 ~ PCDD70c * sex_n, data = all_data_new)
cond_effects_pcdd70_cpath <- emtrends(cond_model_pcdd70_cpath, var = "PCDD70c", specs = "sex_n")
cond_effects_pcdd70_cpath
# Inf, since test and confidence intervals are asymptotic (https://cran.r-project.org/web/packages/emmeans/vignettes/models.html#G) & Sets all the degrees of freedom to Inf -- that's emmeans's way of using z statistics rather than t statistics (https://rdrr.io/cran/emmeans/f/vignettes/sophisticated.Rmd)
pairs(cond_effects_pcdd70_cpath)
interact_plot(cond_model_pcdd70_cpath, pred = PCDD70c, modx = sex_n, plot.points = TRUE, point.shape = TRUE, interval = TRUE, x.label = "PCDD70", y.label = "PDS score (t5-t0)", modx.labels = c("female", "male"), legend.main = "Sex")
#write.csv2(cond_effects_pcdd70_cpath, file = "path/cpath_pcdd70.csv")


model_pcdd70_slope <- '
          slopePDS ~ c*PCDD70c + sex_n + cw*PCDD70c:sex_n + b*Mean_M
          Mean_M ~ a*PCDD70c + sex_n + aw*PCDD70c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdd70_slope.fit.YB <- sem(model_pcdd70_slope, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdd70_slope.fit.YB, fit = TRUE, rsquar = TRUE) # DOES converte!
parameterEstimates(model_pcdd70_slope.fit.YB, ci = T, boot.ci.type = "bca.simple")

```

# PCDD73 - mediation model 

```{r medmodel pcdd73}

all_data_new$PCDD73c <- scale(all_data_new$PCDD73, center = TRUE, scale = FALSE)

skew(all_data_new$PCDD73c)
kurtosis(all_data_new$PCDD73c)

model_pcdd73 <- '
          slopeDiffU15U6 ~ c*PCDD73c + sex_n + cw*PCDD73c:sex_n + b*Mean_M
          Mean_M ~ a*PCDD73c + sex_n + aw*PCDD73c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdd73.fit.YB <- sem(model_pcdd73, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdd73.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdd73.fit.YB, ci = T, boot.ci.type = "bca.simple")


model_pcdd73_slope <- '
          slopePDS ~ c*PCDD73c + sex_n + cw*PCDD73c:sex_n + b*Mean_M
          Mean_M ~ a*PCDD73c + sex_n + aw*PCDD73c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdd73_slope.fit.YB <- sem(model_pcdd73_slope, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdd73_slope.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!

```

# PCDD75 - mediation model 

```{r medmodel pcdd75}

all_data_new$PCDD75c <- scale(all_data_new$PCDD75, center = TRUE, scale = FALSE)

skew(all_data_new$PCDD75c)
kurtosis(all_data_new$PCDD75c)

model_pcdd75 <- '
          slopeDiffU15U6 ~ c*PCDD75c + sex_n + cw*PCDD75c:sex_n + b*Mean_M
          Mean_M ~ a*PCDD75c + sex_n + aw*PCDD75c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdd75.fit.YB <- sem(model_pcdd75, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdd75.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdd75.fit.YB, ci = T, boot.ci.type = "bca.simple")


model_pcdd75_slope <- '
          slopePDS ~ c*PCDD75c + sex_n + cw*PCDD75c:sex_n + b*Mean_M
          Mean_M ~ a*PCDD75c + sex_n + aw*PCDD75c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdd75_slope.fit.YB <- sem(model_pcdd75_slope, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdd75_slope.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!

```

# PCDF114 - mediation model 

```{r medmodel pcdf114}

all_data_new$PCDF114c <- scale(all_data_new$PCDF114, center = TRUE, scale = FALSE)

skew(all_data_new$PCDF114c)
kurtosis(all_data_new$PCDF114c)

model_pcdf114 <- '
          slopeDiffU15U6 ~ c*PCDF114c + sex_n + cw*PCDF114c:sex_n + b*Mean_M
          Mean_M ~ a*PCDF114c + sex_n + aw*PCDF114c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf114.fit.YB <- sem(model_pcdf114, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf114.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdf114.fit.YB, ci = T, boot.ci.type = "bca.simple")

## test conditional sex effect
### c-path
cond_model_pcdf114_cpath <- glm(slopeDiffU15U6 ~ PCDF114c * sex_n, data = all_data_new)
cond_effects_pcdf114_cpath <- emtrends(cond_model_pcdf114_cpath, var = "PCDF114c", specs = "sex_n")
cond_effects_pcdf114_cpath

pairs(cond_effects_pcdf114_cpath)
interact_plot(cond_model_pcdf114_cpath, pred = PCDF114c, modx = sex_n, plot.points = TRUE, point.shape = TRUE, interval = TRUE, x.label = "PCDF114", y.label = "PDS score (t5-t0)", modx.labels = c("female", "male"), legend.main = "Sex")
#write.csv2(cond_effects_pcdf114_cpath, file = "path/cpath_pcdf114.csv")


model_pcdf114_slope <- '
          slopePDS ~ c*PCDF114c + sex_n + cw*PCDF114c:sex_n + b*Mean_M
          Mean_M ~ a*PCDF114c + sex_n + aw*PCDF114c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf114_slope.fit.YB <- sem(model_pcdf114_slope, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf114_slope.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!

```

# PCDF118 - mediation model 

```{r medmodel pcdf118}

all_data_new$PCDF118c <- scale(all_data_new$PCDF118, center = TRUE, scale = FALSE)

skew(all_data_new$PCDF118c)
kurtosis(all_data_new$PCDF118c)

model_pcdf118 <- '
          slopeDiffU15U6 ~ c*PCDF118c + sex_n + cw*PCDF118c:sex_n + b*Mean_M
          Mean_M ~ a*PCDF118c + sex_n + aw*PCDF118c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf118.fit.YB <- sem(model_pcdf118, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf118.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdf118.fit.YB, ci = T, boot.ci.type = "bca.simple")

## test conditional sex effect
### c-path
cond_model_pcdf118_cpath <- glm(slopeDiffU15U6 ~ PCDF118c * sex_n, data = all_data_new)
cond_effects_pcdf118_cpath <- emtrends(cond_model_pcdf118_cpath, var = "PCDF118c", specs = "sex_n")
cond_effects_pcdf118_cpath

pairs(cond_effects_pcdf118_cpath)
interact_plot(cond_model_pcdf118_cpath, pred = PCDF118c, modx = sex_n, plot.points = TRUE, point.shape = TRUE, interval = TRUE, x.label = "PCDF118", y.label = "PDS score (t5-t0)", modx.labels = c("female", "male"), legend.main = "Sex")
#write.csv2(cond_effects_pcdf118_cpath, file = "path/cpath_pcdf118.csv")

model_pcdf118_slope <- '
          slopePDS ~ c*PCDF118c + sex_n + cw*PCDF118c:sex_n + b*Mean_M
          Mean_M ~ a*PCDF118c + sex_n + aw*PCDF118c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf118_slope.fit.YB <- sem(model_pcdf118_slope, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf118_slope.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!

```


# PCDF121 - mediation model 

```{r medmodel pcdf121}

all_data_new$PCDF121c <- scale(all_data_new$PCDF121, center = TRUE, scale = FALSE)

skew(all_data_new$PCDF121c)
kurtosis(all_data_new$PCDF121c)

model_pcdf121 <- '
          slopeDiffU15U6 ~ c*PCDF121c + sex_n + cw*PCDF121c:sex_n + b*Mean_M  
          Mean_M ~ a*PCDF121c + sex_n + aw*PCDF121c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf121.fit.YB <- sem(model_pcdf121, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf121.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdf121.fit.YB, ci = T, boot.ci.type = "bca.simple")


model_pcdf121_slope <- '
          slopePDS ~ c*PCDF121c + sex_n + cw*PCDF121c:sex_n + b*Mean_M
          Mean_M ~ a*PCDF121c + sex_n + aw*PCDF121c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf121_slope.fit.YB <- sem(model_pcdf121_slope, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf121_slope.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!

```

# PCDF130 - mediation model 

```{r medmodel pcdf130}

all_data_new$PCDF130c <- scale(all_data_new$PCDF130, center = TRUE, scale = FALSE)

skew(all_data_new$PCDF130c)
kurtosis(all_data_new$PCDF130c)

model_pcdf130 <- '
          slopeDiffU15U6 ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*Mean_M  
          Mean_M ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130.fit.YB <- sem(model_pcdf130, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdf130.fit.YB, ci = T, boot.ci.type = "bca.simple")


model_pcdf130_slope <- '
          slopePDS ~ c*PCDF130c + sex_n + cw*PCDF130c:sex_n + b*Mean_M
          Mean_M ~ a*PCDF130c + sex_n + aw*PCDF130c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf130_slope.fit.YB <- sem(model_pcdf130_slope, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf130_slope.fit.YB, fit = TRUE, rsquar = TRUE) # does not converte!

```

# PCDF131 - mediation model 

```{r medmodel pcdf131}

all_data_new$PCDF131c <- scale(all_data_new$PCDF131, center = TRUE, scale = FALSE)

skew(all_data_new$PCDF131c)
kurtosis(all_data_new$PCDF131c)

model_pcdf131 <- '
          slopeDiffU15U6 ~ c*PCDF131c + sex_n + cw*PCDF131c:sex_n + b*Mean_M  
          Mean_M ~ a*PCDF131c + sex_n + aw*PCDF131c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf131.fit.YB <- sem(model_pcdf131, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf131.fit.YB, fit = TRUE, rsquar = TRUE)
parameterEstimates(model_pcdf131.fit.YB, ci = T, boot.ci.type = "bca.simple")


model_pcdf131_slope <- '
          slopePDS ~ c*PCDF131c + sex_n + cw*PCDF131c:sex_n + b*Mean_M
          Mean_M ~ a*PCDF131c + sex_n + aw*PCDF131c:sex_n
		      indirect0 := a*b # + 0*aw*b
		      total0 := c + indirect0 # + 0*cw
          indirect1 := indirect0 + 1*aw*b
          total1 := c + indirect1 + 1*cw
          diffind := indirect0 - indirect1
          difftotal := total0 - total1' 
model_pcdf131_slope.fit.YB <- sem(model_pcdf131_slope, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_pcdf131_slope.fit.YB, fit = TRUE, rsquar = TRUE) # does converte!

```

# export results to tables & figures

```{r table & figures}

l_pcb77 <- parameterEstimates(model_pcb77.fit.YB)[c(1:7), ]
l_pcb77
b_pcb77 <- gettextf('%s %.2f \n p=%.2f', l_pcb77$label, l_pcb77$est, digits = l_pcb77$pvalue)
b_pcb77 <- gsub(".*p=NA.*", "", b_pcb77)
b_pcb77 <- gsub("w", "*sex", b_pcb77)
b_pcb77
#semPaths(model_pcb77.fit.YB, what= "path", whatLabels = "est", intercepts = FALSE, rotation = 2)
semPaths(model_pcb77.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcb77, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "DNAm\nESR2", "PCB77", "child큦\nsex", "PCB77*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)


l_pcb81 <- parameterEstimates(model_pcb81.fit.YB)[c(1:7), ]
l_pcb81
b_pcb81 <- gettextf('%s %.2f \n p=%.2f', l_pcb81$label, l_pcb81$est, digits = l_pcb81$pvalue)
b_pcb81 <- gsub(".*p=NA.*", "", b_pcb81)
b_pcb81 <- gsub("w", "*sex", b_pcb81)
b_pcb81
semPaths(model_pcb81.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcb81, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "DNAm\nESR2", "PCB81", "child큦\nsex", "PCB81*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)

l_pcb126 <- parameterEstimates(model_pcb126.fit.YB)[c(1:7), ]
l_pcb126
b_pcb126 <- gettextf('%s %.2f \n p=%.2f', l_pcb126$label, l_pcb126$est, digits = l_pcb126$pvalue)
b_pcb126 <- gsub(".*p=NA.*", "", b_pcb126)
b_pcb126 <- gsub("w", "*sex", b_pcb126)
b_pcb126
semPaths(model_pcb126.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcb126, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "DNAm\nESR2", "PCB126", "child큦\nsex", "PCB126*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)

l_pcb169 <- parameterEstimates(model_pcb169.fit.YB)[c(1:7), ]
l_pcb169
b_pcb169 <- gettextf('%s %.2f \n p=%.2f', l_pcb169$label, l_pcb169$est, digits = l_pcb169$pvalue)
b_pcb169 <- gsub(".*p=NA.*", "", b_pcb169)
b_pcb169 <- gsub("w", "*sex", b_pcb169)
b_pcb169
semPaths(model_pcb169.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcb169, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "DNAm\nESR2", "PCB169", "child큦\nsex", "PCB169*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)

l_pcdd48 <- parameterEstimates(model_pcdd48.fit.YB)[c(1:7), ]
l_pcdd48
b_pcdd48 <- gettextf('%s %.2f \n p=%.2f', l_pcdd48$label, l_pcdd48$est, digits = l_pcdd48$pvalue)
b_pcdd48 <- gsub(".*p=NA.*", "", b_pcdd48)
b_pcdd48 <- gsub("w", "*sex", b_pcdd48)
b_pcdd48
semPaths(model_pcdd48.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdd48, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "DNAm\nESR2", "PCDD48", "child큦\nsex", "PCDD48*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)

l_pcdd54 <- parameterEstimates(model_pcdd54.fit.YB)[c(1:7), ]
l_pcdd54
b_pcdd54 <- gettextf('%s %.2f \n p=%.2f', l_pcdd54$label, l_pcdd54$est, digits = l_pcdd54$pvalue)
b_pcdd54 <- gsub(".*p=NA.*", "", b_pcdd54)
b_pcdd54 <- gsub("w", "*sex", b_pcdd54)
b_pcdd54
semPaths(model_pcdd54.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdd54, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "DNAm\nESR2", "PCDD54", "child큦\nsex", "PCDD54*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)

l_pcdd66 <- parameterEstimates(model_pcdd66.fit.YB)[c(1:7), ]
l_pcdd66
b_pcdd66 <- gettextf('%s %.2f \n p=%.2f', l_pcdd66$label, l_pcdd66$est, digits = l_pcdd66$pvalue)
b_pcdd66 <- gsub(".*p=NA.*", "", b_pcdd66)
b_pcdd66 <- gsub("w", "*sex", b_pcdd66)
b_pcdd66
semPaths(model_pcdd66.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdd66, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "DNAm\nESR2", "PCDD66", "child큦\nsex", "PCDD66*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)

l_pcdd67 <- parameterEstimates(model_pcdd67.fit.YB)[c(1:7), ]
l_pcdd67
b_pcdd67 <- gettextf('%s %.2f \n p=%.2f', l_pcdd67$label, l_pcdd67$est, digits = l_pcdd67$pvalue)
b_pcdd67 <- gsub(".*p=NA.*", "", b_pcdd67)
b_pcdd67 <- gsub("w", "*sex", b_pcdd67)
b_pcdd67
semPaths(model_pcdd67.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdd67, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "DNAm\nESR2", "PCDD67", "child큦\nsex", "PCDD67*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)

l_pcdd70 <- parameterEstimates(model_pcdd70.fit.YB)[c(1:7), ]
l_pcdd70
b_pcdd70 <- gettextf('%s %.2f \n p=%.2f', l_pcdd70$label, l_pcdd70$est, digits = l_pcdd70$pvalue)
b_pcdd70 <- gsub(".*p=NA.*", "", b_pcdd70)
b_pcdd70 <- gsub("w", "*sex", b_pcdd70)
b_pcdd70
semPaths(model_pcdd70.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdd70, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "DNAm\nESR2", "PCDD70", "child큦\nsex", "PCDD70*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)

l_pcdd70_slope <- parameterEstimates(model_pcdd70_slope.fit.YB)[c(1:7), ]
l_pcdd70_slope
b_pcdd70_slope <- gettextf('%s %.2f \n p=%.2f', l_pcdd70_slope$label, l_pcdd70_slope$est, digits = l_pcdd70_slope$pvalue)
b_pcdd70_slope <- gsub(".*p=NA.*", "", b_pcdd70_slope)
b_pcdd70_slope <- gsub("w", "*sex", b_pcdd70_slope)
b_pcdd70_slope
semPaths(model_pcdd70_slope.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdd70_slope, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("longitu.\npubert.\ndevelop.", "DNAm\nESR2", "PCDD70", "child큦\nsex", "PCDD70*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)

l_pcdd73 <- parameterEstimates(model_pcdd73.fit.YB)[c(1:7), ]
l_pcdd73
b_pcdd73 <- gettextf('%s %.2f \n p=%.2f', l_pcdd73$label, l_pcdd73$est, digits = l_pcdd73$pvalue)
b_pcdd73 <- gsub(".*p=NA.*", "", b_pcdd73)
b_pcdd73 <- gsub("w", "*sex", b_pcdd73)
b_pcdd73
semPaths(model_pcdd73.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdd73, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "DNAm\nESR2", "PCDD73", "child큦\nsex", "PCDD73*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)

l_pcdd75 <- parameterEstimates(model_pcdd75.fit.YB)[c(1:7), ]
l_pcdd75
b_pcdd75 <- gettextf('%s %.2f \n p=%.2f', l_pcdd75$label, l_pcdd75$est, digits = l_pcdd75$pvalue)
b_pcdd75 <- gsub(".*p=NA.*", "", b_pcdd75)
b_pcdd75 <- gsub("w", "*sex", b_pcdd75)
b_pcdd75
semPaths(model_pcdd75.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdd75, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "DNAm\nESR2", "PCDD75", "child큦\nsex", "PCDD75*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)

l_pcdf114 <- parameterEstimates(model_pcdf114.fit.YB)[c(1:7), ]
l_pcdf114
b_pcdf114 <- gettextf('%s %.2f \n p=%.2f', l_pcdf114$label, l_pcdf114$est, digits = l_pcdf114$pvalue)
b_pcdf114 <- gsub(".*p=NA.*", "", b_pcdf114)
b_pcdf114 <- gsub("w", "*sex", b_pcdf114)
b_pcdf114
semPaths(model_pcdf114.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf114, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "DNAm\nESR2", "PCDF114", "child큦\nsex", "PCDF114*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)

l_pcdf118 <- parameterEstimates(model_pcdf118.fit.YB)[c(1:7), ]
l_pcdf118
b_pcdf118 <- gettextf('%s %.2f \n p=%.2f', l_pcdf118$label, l_pcdf118$est, digits = l_pcdf118$pvalue)
b_pcdf118 <- gsub(".*p=NA.*", "", b_pcdf118)
b_pcdf118 <- gsub("w", "*sex", b_pcdf118)
b_pcdf118
semPaths(model_pcdf118.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf118, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "DNAm\nESR2", "PCDF118", "child큦\nsex", "PCDF118*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)

l_pcdf121 <- parameterEstimates(model_pcdf121.fit.YB)[c(1:7), ]
l_pcdf121
b_pcdf121 <- gettextf('%s %.2f \n p=%.2f', l_pcdf121$label, l_pcdf121$est, digits = l_pcdf121$pvalue)
b_pcdf121 <- gsub(".*p=NA.*", "", b_pcdf121)
b_pcdf121 <- gsub("w", "*sex", b_pcdf121)
b_pcdf121
semPaths(model_pcdf121.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf121, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "DNAm\nESR2", "PCDF121", "child큦\nsex", "PCDF121*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)

l_pcdf130 <- parameterEstimates(model_pcdf130.fit.YB)[c(1:7), ]
l_pcdf130
b_pcdf130 <- gettextf('%s %.2f \n p=%.2f', l_pcdf130$label, l_pcdf130$est, digits = l_pcdf130$pvalue)
b_pcdf130 <- gsub(".*p=NA.*", "", b_pcdf130)
b_pcdf130 <- gsub("w", "*sex", b_pcdf130)
b_pcdf130
semPaths(model_pcdf130.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf130, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "DNAm\nESR2", "PCDF130", "child큦\nsex", "PCDF130*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)

l_pcdf131 <- parameterEstimates(model_pcdf131.fit.YB)[c(1:7), ]
l_pcdf131
b_pcdf131 <- gettextf('%s %.2f \n p=%.2f', l_pcdf131$label, l_pcdf131$est, digits = l_pcdf131$pvalue)
b_pcdf131 <- gsub(".*p=NA.*", "", b_pcdf131)
b_pcdf131 <- gsub("w", "*sex", b_pcdf131)
b_pcdf131
semPaths(model_pcdf131.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf131, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("PDS score\n(t5-t0)", "DNAm\nESR2", "PCDF131", "child큦\nsex", "PCDF131*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)

l_pcdf131_slope <- parameterEstimates(model_pcdf131_slope.fit.YB)[c(1:7), ]
l_pcdf131_slope
b_pcdf131_slope <- gettextf('%s %.2f \n p=%.2f', l_pcdf131_slope$label, l_pcdf131_slope$est, digits = l_pcdf131_slope$pvalue)
b_pcdf131_slope <- gsub(".*p=NA.*", "", b_pcdf131_slope)
b_pcdf131_slope <- gsub("w", "*sex", b_pcdf131_slope)
b_pcdf131_slope
semPaths(model_pcdf131_slope.fit.YB, what = "path", whatLabels = "est", intercepts = FALSE, layout = "tree", rotation = 2, panelGroups = TRUE, edgeLabels = b_pcdf131_slope, label.prop = 1,  edge.label.bg = FALSE, edge.label.cex = .7, fade = FALSE, nodeLabels = c("longitu.\npubert.\ndevelop.", "DNAm\nESR2", "PCDF131", "child큦\nsex", "PCDF131*\nchild큦 sex"), edge.label.position = .7, edge.width = .6, node.width = 1.2, curve = 2)


```

# post-hoc alpha-cumulation corrections

```{r post hoc}

# post-hoc alpha-cumulation correction
## post-hoc alpha correction
pvalue_labels_pcb126 <- data.frame(parameterEstimates(model_pcb126.fit.YB, ci = T, boot.ci.type = "bca.simple"))
pvalue_labels_pcdd54 <- data.frame(parameterEstimates(model_pcdd54.fit.YB, ci = T, boot.ci.type = "bca.simple"))
pvalue_labels_pcdd73 <- data.frame(parameterEstimates(model_pcdd73.fit.YB, ci = T, boot.ci.type = "bca.simple"))
pvalue_labels_pcdd75 <- data.frame(parameterEstimates(model_pcdd75.fit.YB, ci = T, boot.ci.type = "bca.simple"))

pvalues_b_all <- c(pvalue_labels_pcb126$pvalue[4], pvalue_labels_pcdd54$pvalue[4], pvalue_labels_pcdd73$pvalue[4], pvalue_labels_pcdd75$pvalue[4], 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
pvalue_b_FDR <- p.adjust(pvalues_b_all, method = "BH") # ns

pvalue_labels_pcdd48 <- data.frame(parameterEstimates(model_pcdd48.fit.YB, ci = T, boot.ci.type = "bca.simple"))
pvalue_a_FDR_pcdd48<- p.adjust(pvalue_labels_pcdd48$pvalue[5], method = "BH", n = 16) # ns

pvalue_labels_pcb169 <- data.frame(parameterEstimates(model_pcb169.fit.YB, ci = T, boot.ci.type = "bca.simple"))
pvalue_labels_pcdf114 <- data.frame(parameterEstimates(model_pcdf114.fit.YB, ci = T, boot.ci.type = "bca.simple"))
pvalue_labels_pcdf118 <- data.frame(parameterEstimates(model_pcdf118.fit.YB, ci = T, boot.ci.type = "bca.simple"))
pvalues_cw_all <- c(pvalue_labels_pcb169$pvalue[3], pvalue_labels_pcdf114$pvalue[3], pvalue_labels_pcdf118 $pvalue[3], 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
pvalue_cw_FDR <- p.adjust(pvalues_cw_all, method = "BH") # ns

## b-paht sex-moderated?

lm_b <- glm(slopeDiffU15U6 ~ Mean_M, data = all_data_new)
summary(lm_b)

lm_b_sex <- glm(slopeDiffU15U6 ~ Mean_M + sex_n, data = all_data_new)
summary(lm_b_sex)

lm_b_sex_i <- glm(slopeDiffU15U6 ~ Mean_M * sex_n, data = all_data_new)
summary(lm_b_sex_i)
anova(lm_b, lm_b_sex, lm_b_sex_i)

lm_b_pcb126<- glm(slopeDiffU15U6 ~ Mean_M + PCB126c, data = all_data_new)
summary(lm_b_pcb126)

model_b <- '
          slopeDiffU15U6 ~ Mean_M
          ' 
model_b.fit.YB <- sem(model_b, data = all_data_new, se = "bootstrap", bootstrap = 10000, test = "yuan.bentler", missing = "fiml.x")
summary(model_b.fit.YB, fit = TRUE, rsquar = TRUE)

```

# save

```{r save}

#save.image("path/mediation_ESR2bisulfitseq_image2.RData")

```
